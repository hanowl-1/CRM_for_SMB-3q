# 🚀 실제 메시지 발송 설정 가이드

## 📋 개요
워크플로우 테스트에서 **실제 메시지 발송**을 활성화하려면 다음 환경변수들이 올바르게 설정되어야 합니다.

## 🔧 필수 환경변수 설정

### 1. `.env.local` 파일 생성
프로젝트 루트 디렉토리에 `.env.local` 파일을 생성하고 다음 내용을 추가하세요:

```bash
# CoolSMS API 설정
COOLSMS_API_KEY=your_coolsms_api_key
COOLSMS_API_SECRET=your_coolsms_api_secret

# 카카오톡 알림톡 설정
KAKAO_SENDER_KEY=your_kakao_sender_key

# 테스트 전화번호 (기본값)
TEST_PHONE_NUMBER=01012345678

# SMS 발신번호 (CoolSMS에 등록된 번호)
SMS_SENDER_NUMBER=01012345678
```

### 2. CoolSMS 설정

#### 2.1 CoolSMS 계정 생성 및 API 키 발급
1. [CoolSMS 웹사이트](https://www.coolsms.co.kr/)에서 계정 생성
2. 대시보드 → API 키 관리에서 API 키와 시크릿 발급
3. 발급받은 키를 환경변수에 설정:
   ```bash
   COOLSMS_API_KEY=NCS58351F3F67A86
   COOLSMS_API_SECRET=2297F1399AC1B71E68CB517AA55984FF
   ```

#### 2.2 발신번호 등록
1. CoolSMS 대시보드 → 발신번호 관리
2. 사용할 전화번호 등록 및 인증 완료
3. 인증된 번호를 환경변수에 설정:
   ```bash
   SMS_SENDER_NUMBER=01041513771
   ```

### 3. 카카오톡 알림톡 설정

#### 3.1 카카오톡 채널 생성
1. [카카오톡 채널 관리자센터](https://center-pf.kakao.com/)에서 채널 생성
2. 채널 검수 완료 후 알림톡 서비스 신청

#### 3.2 발신키 발급
1. 카카오톡 비즈니스 → 알림톡 → 발신 프로필 관리
2. 발신키(Sender Key) 발급
3. 발급받은 키를 환경변수에 설정:
   ```bash
   KAKAO_SENDER_KEY=your_actual_sender_key
   ```

#### 3.3 템플릿 등록
1. 사용할 알림톡 템플릿을 카카오에 등록
2. 템플릿 승인 완료 후 템플릿 코드 확인

## 🧪 테스트 방법

### 1. 환경변수 확인
워크플로우 테스트 실행 시 다음 정보가 표시됩니다:
```
🔧 환경변수 상태:
• COOLSMS API 키: ✅ 설정됨
• COOLSMS API 시크릿: ✅ 설정됨  
• 카카오 발신키: ❌ 누락
• 테스트 전화번호: 01041513771
```

### 2. 실제 발송 테스트
1. 워크플로우 빌더에서 **테스트 설정** 탭으로 이동
2. **실제 발송** 옵션을 ✅ 활성화
3. **수신번호**에 테스트할 전화번호 입력
4. **테스트 실행** 버튼 클릭

## ⚠️ 주의사항

### 1. 비용 발생
- 실제 발송 시 CoolSMS 요금이 부과됩니다
- 알림톡: 건당 약 15원
- SMS: 건당 약 20원
- LMS: 건당 약 50원

### 2. 발신번호 제한
- 등록되지 않은 번호로는 발송할 수 없습니다
- 개인번호는 본인인증 후 사용 가능
- 사업자번호는 사업자등록증 제출 후 사용 가능

### 3. 알림톡 제한
- 승인된 템플릿만 사용 가능
- 템플릿 내용 변경 시 재승인 필요
- 수신자가 카카오톡 채널을 차단한 경우 발송 불가

## 🔍 문제 해결

### 환경변수가 인식되지 않는 경우
1. `.env.local` 파일이 프로젝트 루트에 있는지 확인
2. 개발 서버 재시작: `npm run dev`
3. 환경변수명에 오타가 없는지 확인

### 발송이 실패하는 경우
1. CoolSMS 계정 잔액 확인
2. 발신번호 등록 상태 확인
3. 카카오 발신키 유효성 확인
4. 템플릿 승인 상태 확인

### 알림톡이 SMS로 대체 발송되는 경우
- 정상적인 동작입니다 (fallback 기능)
- 알림톡 발송 실패 시 자동으로 SMS로 발송
- **SMS 대체** 옵션을 비활성화하면 알림톡 실패 시 발송하지 않음

## 📞 지원

문제가 지속되는 경우:
1. CoolSMS 고객지원: 1588-0606
2. 카카오톡 비즈니스 고객센터: 1544-4293
3. 개발팀 문의: 프로젝트 이슈 트래커 활용 