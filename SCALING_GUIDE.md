# 대규모 운영을 위한 확장성 가이드

## 현재 시스템 용량

### 기본 설정
- **배치 크기**: 50개 작업/실행
- **실행 주기**: 5분마다
- **일일 최대 처리량**: 14,400개 작업 (50 × 12 × 24)

### 대규모 운영 시나리오

#### 시나리오 1: 일일 2,000건 발송 + 100개 워크플로우
- **예상 부하**: 매우 낮음 ✅
- **필요 설정**: 기본 설정으로 충분
- **여유도**: 7배 이상

#### 시나리오 2: 일일 10,000건 발송 + 500개 워크플로우
- **예상 부하**: 낮음 ✅
- **권장 설정**: 
  - `SCHEDULER_BATCH_SIZE=100`
  - cron 주기: 3분마다
- **여유도**: 2배 이상

#### 시나리오 3: 일일 50,000건 발송 + 1,000개 워크플로우
- **예상 부하**: 높음 ⚠️
- **필요 조치**: 시스템 업그레이드 필요

## 확장 방법

### 1. 환경변수 설정
```bash
# Vercel 환경변수에 추가
SCHEDULER_BATCH_SIZE=100  # 배치 크기 증가
```

### 2. cron-job.org 주기 조정
```
# 더 자주 실행 (3분마다)
*/3 * * * *

# 또는 1분마다 (고부하 시)
*/1 * * * *
```

### 3. Vercel Pro 업그레이드
- **함수 실행 시간**: 최대 900초
- **메모리**: 최대 3GB
- **동시 실행**: 무제한

### 4. 병렬 처리 구현
```typescript
// 워크플로우 병렬 실행
await Promise.all(
  jobs.map(job => this.executeJob(job))
);
```

## 모니터링

### 성능 지표
- **처리량**: 분당 처리된 작업 수
- **실행 시간**: 평균 함수 실행 시간
- **실패율**: 실패한 작업 비율
- **대기 시간**: 예약 시간과 실제 실행 시간 차이

### 알림 설정
- **실패 임계값**: 연속 3회 실패 시 알림
- **지연 임계값**: 10분 이상 지연 시 알림
- **용량 임계값**: 대기 작업 100개 이상 시 알림

## 비용 최적화

### cron-job.org 요금제
- **무료**: 5개 작업, 1분 간격
- **프리미엄**: 무제한 작업, 초 단위 간격

### Vercel 요금제
- **Hobby**: 무료, 제한적
- **Pro**: $20/월, 고성능
- **Enterprise**: 맞춤형

### CoolSMS 요금
- **알림톡**: 건당 15원
- **SMS**: 건당 20원
- **대량 할인**: 월 10만건 이상 시 협의

## 장애 대응

### 일반적인 문제
1. **타임아웃**: 배치 크기 줄이기
2. **메모리 부족**: Vercel Pro 업그레이드
3. **API 제한**: CoolSMS 요청 간격 조정
4. **DB 연결**: Supabase 연결 풀 최적화

### 백업 계획
1. **다중 cron 서비스**: EasyCron, GitHub Actions
2. **수동 실행**: 웹 인터페이스에서 즉시 실행
3. **로그 모니터링**: 실시간 상태 확인

## 결론

현재 시스템은 **일일 2,000건 + 100개 워크플로우**를 여유롭게 처리할 수 있습니다.
더 큰 규모가 필요한 경우 위의 확장 방법을 단계적으로 적용하세요. 