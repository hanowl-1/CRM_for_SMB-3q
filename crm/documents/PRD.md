# PRD (Product Requirements Document)
## 카카오톡/문자 메시지 자동화 플랫폼

### 1. 제품 개요

#### 1.1 제품명
**메시지 자동화 플랫폼** - 카카오톡 알림톡 및 문자 메시지 자동 발송 시스템

#### 1.2 제품 목적
**기존 운영중인 자영업자 구독 서비스(SaaS)의 보조 서비스**로서, 구독중이거나 구독을 취소한 고객사를 대상으로 알림톡 및 문자를 각 상태에 맞춰 자동으로 발송하기 위함

**주요 목적:**
- 기존 구독 서비스의 고객 관리 효율성 향상
- 구독 상태별 맞춤형 자동 메시지 발송
- 기존 운영 데이터베이스와의 실시간 연동
- 고객 이탈 방지 및 재구독 유도

#### 1.3 서비스 특징
- **보조 서비스**: 기존 SaaS 플랫폼에 추가되는 메시지 자동화 기능
- **기존 DB 연동**: 운영중인 SQL 서버의 고객 데이터 실시간 활용
- **변수 기반 개인화**: 기존 DB 필드를 변수로 활용한 개인화 메시지
- **구독 상태 기반 워크플로우**: 구독/취소/일시정지 등 상태별 자동화

#### 1.4 타겟 사용자
- 고객 서비스 담당자
- 마케팅 담당자

### 2. 구현 현황 및 MVP 기능 정의

#### 2.1 ✅ 구현 완료된 핵심 기능 (Must Have)

##### 2.1.1 ✅ 메시지 작성 및 관리
- **✅ 메시지 유형 선택**
  - ✅ 카카오 알림톡 (CoolSMS API 연동 완료)
  - ✅ SMS (단문 메시지) - 완전 구현
  - ✅ LMS (장문 메시지) - 완전 구현
  
- **✅ 변수 기반 개인화**
  - ✅ DB 필드 연동을 통한 동적 변수 삽입
  - ✅ 기본 변수: 고객명, 전화번호, 구매금액 등
  - ✅ 커스텀 변수 추가 가능
  - ✅ 실시간 메시지 미리보기
  - ✅ 개별 변수 매핑 저장/불러오기 (Supabase 연동)

- **✅ 메시지 템플릿 관리**
  - ✅ 템플릿 빌더 (완전한 UI/UX)
  - ✅ 템플릿 라이브러리 (카테고리화 완료)
  - ✅ 변수 삽입 및 미리보기
  - ✅ 버튼 기능 지원 (URL 링크, 전화걸기 등)
  - ✅ CoolSMS 등록 가이드 제공

##### 2.1.2 ✅ 자동화 워크플로우
- **✅ 트리거 이벤트 설정**
  - ✅ 수동 실행 (완전 구현)
  - 🔄 구독 신규 가입 (구조 준비됨)
  - 🔄 구독 취소 (구조 준비됨)
  - 🔄 구독 일시정지 (구조 준비됨)
  - 🔄 구독 재개 (구조 준비됨)
  - 🔄 결제 실패 (구조 준비됨)
  - 🔄 구독 만료 예정 (구조 준비됨)

- **✅ 대상 고객 선별**
  - ✅ MySQL 연동 쿼리 기반 대상 선정
  - ✅ 정적 대상 그룹 (직접 입력)
  - ✅ 동적 대상 그룹 (SQL 쿼리 기반)
  - ✅ 쿼리 테스트 및 미리보기
  - ✅ 다중 조건 조합 (AND/OR 로직)
  - ✅ 실시간 데이터 동기화 기반 동적 세그멘테이션

- **✅ 발송 타이밍 제어**
  - ✅ 즉시 발송
  - ✅ 지연 발송 (분/시간/일 단위)
  - ✅ 특정 시간 예약 발송
  - ✅ 반복 발송 (일간/주간/월간)
  - ✅ 완전한 스케줄러 시스템 (2024년 6월 신규 구축)

- **✅ 스케줄러 시스템 (신규 구축 완료)**
  - ✅ 인메모리 기반 스케줄러 엔진
  - ✅ 백그라운드 작업 관리 (매분 실행)
  - ✅ 다양한 실행 모드 (즉시/지연/예약/반복)
  - ✅ 홈페이지 실시간 모니터링 카드
  - ✅ 워크플로우 자동 등록 시스템

##### 2.1.3 ✅ 캠페인 관리
- **✅ 워크플로우 관리**
  - ✅ 6단계 워크플로우 빌더 (기본정보, 템플릿선택, 대상선정, 매핑, 스케줄러, 테스트)
  - ✅ 워크플로우 활성화/비활성화
  - ✅ 워크플로우 복제 및 수정
  - ✅ 실시간 테스트 실행
  - ✅ Supabase 기반 영구 저장
  - ✅ 하이브리드 데이터 소스 지원 (localStorage + Supabase)
  - ✅ 워크플로우 설정 페이지 Supabase 연동 완료 (2024년 6월)

- **✅ 변수-대상 매핑**
  - ✅ 알림톡 템플릿 변수와 대상 그룹 데이터 필드 자동 매칭
  - ✅ 변수별 데이터 소스 선택 (대상 쿼리 결과 컬럼)
  - ✅ 매핑 완성도 실시간 체크
  - ✅ 매핑 결과 미리보기

##### 2.1.4 ✅ 대시보드 및 통계
- **✅ 실시간 통계**
  - ✅ 총 워크플로우 수 (Supabase 기반)
  - ✅ 활성/초안/전체 워크플로우 통계
  - ✅ 워크플로우 목록 및 상태 관리
  - ✅ 최근 실행 기록
  - ✅ 스케줄러 상태 실시간 모니터링 (2024년 6월 신규)

- **✅ 스케줄러 모니터링 카드 (신규 추가)**
  - ✅ 스케줄러 실행 상태 (실행 중/중지됨)
  - ✅ 작업 통계 (총 작업, 대기 중, 실행 중, 완료)
  - ✅ 다음 실행 예정 작업 정보
  - ✅ 30초마다 자동 상태 갱신

- **✅ 성과 분석**
  - ✅ 워크플로우별 테스트 결과
  - ✅ 메시지 발송 성공/실패 로그
  - ✅ 단계별 실행 결과 추적

#### 2.2 ✅ 구현 완료된 중요 기능 (Should Have)

##### 2.2.1 ✅ 고급 세그멘테이션
- **✅ 복합 조건 설정**
  - ✅ MySQL 기반 복잡한 쿼리 조건
  - ✅ 쿼리 결과 실시간 미리보기
  - ✅ 변수 매핑 자동화

##### 2.2.2 ✅ 데이터베이스 연동
- **✅ MySQL 읽기 전용 연동**
  - ✅ 실시간 쿼리 실행
  - ✅ 쿼리 결과 검증
  - ✅ 에러 처리 및 디버깅

- **✅ Supabase 연동**
  - ✅ 워크플로우 영구 저장
  - ✅ 변수 매핑 템플릿 관리
  - ✅ 개별 변수 매핑 저장
  - ✅ 사용 통계 추적

##### 2.2.3 ✅ 메시지 발송 시스템
- **✅ CoolSMS API 완전 연동**
  - ✅ 알림톡 발송 (템플릿 기반)
  - ✅ SMS/LMS 발송
  - ✅ 발신번호 관리
  - ✅ 실제/테스트 모드 지원
  - ✅ 에러 처리 및 대체 발송

##### 2.2.4 ✅ 단순 발송 도구
- **✅ 단순 SMS 발송 페이지**
  - ✅ 즉시 SMS/LMS 발송
  - ✅ 변수 치환 지원
  - ✅ 템플릿 제공
  - ✅ 실시간 메시지 타입 감지

#### 2.3 🔄 개발 진행 중 기능 (Could Have)

##### 2.3.1 🔄 고급 분석
- 🔄 고객 여정 분석 (구조 준비됨)
- 🔄 ROI 측정 (구조 준비됨)
- 🔄 예측 분석 (구조 준비됨)

##### 2.3.2 ❌ 향후 개발 예정
- ❌ 이메일 마케팅
- ❌ 푸시 알림
- ❌ 채팅봇 연동

### 3. 기술 스택 (구현 완료)

#### 3.1 ✅ 현재 기술 스택 (웹 우선 개발)
- **✅ Frontend (Web)**: Next.js 15, React 19, TypeScript
- **✅ UI Components**: Radix UI, Tailwind CSS
- **✅ Form Handling**: React Hook Form, Zod
- **✅ State Management**: React useState/hooks, Context API
- **✅ Charts**: Recharts
- **✅ Icons**: Lucide React
- **✅ Navigation**: Next.js Router

#### 3.2 ✅ 백엔드 구현 완료
- **✅ Primary Database**: MySQL 연동 (읽기 전용)
- **✅ Message Platform DB**: Supabase PostgreSQL (완전 구현)
- **✅ API Integration**: Next.js API Routes
- **✅ Database Integration**: 
  - ✅ MySQL 연동 (기존 고객 데이터)
  - ✅ Supabase (메시지 플랫폼 전용 데이터)
- **✅ Message Service Integration**: 
  - ✅ CoolSMS API (완전 연동)
  - ✅ 카카오 비즈니스 API (알림톡)

#### 3.3 ✅ 데이터베이스 연동 완료
- **✅ 하이브리드 DB 구조**
  - **✅ MySQL**: 고객 데이터, 구독 정보 (읽기 전용)
  - **✅ Supabase**: 메시지 플랫폼 전용 데이터 (완전 구현)
  - **✅ 실시간 쿼리**: 동적 대상 선정 및 변수 매핑

### 4. 사용자 여정 (User Journey) - 구현 완료

#### 4.1 ✅ 첫 방문 사용자 (기존 SaaS 관리자)
1. ✅ 대시보드에서 "새 워크플로우 만들기" 클릭
2. ✅ 6단계 워크플로우 빌더 진행
3. ✅ MySQL 데이터 기반 대상 선정
4. ✅ 변수 매핑 및 개인화 설정
5. ✅ 테스트 발송 (실제 데이터로)
6. ✅ Supabase에 워크플로우 저장

#### 4.2 ✅ 기존 사용자 (일상적 운영)
1. ✅ 대시보드에서 워크플로우 현황 확인
2. ✅ 기존 워크플로우 수정/복제
3. ✅ 단순 SMS 발송 도구 사용
4. ✅ 템플릿 라이브러리에서 템플릿 관리
5. ✅ 변수 쿼리 템플릿 저장/재사용

### 5. 주요 화면 구성 (구현 완료)

#### 5.1 ✅ 대시보드
- ✅ 통계 카드 (워크플로우 수, 상태별 분류)
- ✅ 워크플로우 목록 및 상태 관리 (Supabase 기반)
- ✅ 빠른 액션 버튼 (새 워크플로우, 단순 발송 등)
- ✅ 메시지 도구 섹션 (템플릿 빌더, 라이브러리, SMS 발송)

#### 5.2 ✅ 워크플로우 생성/편집
- ✅ 6단계 설정 프로세스:
  1. ✅ 기본정보 (이름, 설명)
  2. ✅ 알림톡 템플릿 선택 (카카오 비즈니스에 등록된 템플릿 선택 및 변수 매핑)
  3. ✅ 대상 선정 (정적/동적 그룹, 쿼리 기반 대상 선별)
  4. ✅ 변수-대상 매핑 (템플릿 변수와 대상 데이터 필드 매핑)
  5. ✅ 스케줄러 설정 (즉시/지연 발송)
  6. ✅ 테스트 설정 (실제/시뮬레이션 모드)

#### 5.2.1 ✅ 알림톡 선택 탭 - 상세 기능
- **✅ 카카오 비즈니스 템플릿 연동**
  - ✅ CoolSMS에 등록된 알림톡 템플릿 목록 조회
  - ✅ 템플릿 검색 및 필터링 (카테고리별, 키워드별)
  - ✅ 템플릿 미리보기 및 변수 확인
  - ✅ 다중 템플릿 선택 지원

- **✅ 변수 매핑 시스템**
  - ✅ 템플릿 내 변수 자동 감지 (#{변수명} 형태)
  - ✅ 각 변수별 개별 쿼리 설정
  - ✅ 변수별 출력 컬럼 선택
  - ✅ 변수 쿼리 테스트 및 미리보기
  - ✅ 변수 매핑 저장/불러오기 기능

- **✅ 템플릿 개인화 설정**
  - ✅ 버튼 기능 지원 (URL 링크, 전화걸기 등)
  - ✅ 실시간 메시지 미리보기
  - ✅ 변수 치환 결과 확인

#### 5.2.2 ✅ 대상 선정 탭 - 상세 기능
- **✅ 정적 대상 그룹**
  - ✅ 기존 테이블 기반 대상 선정
  - ✅ 테이블 스키마 자동 조회
  - ✅ 필터 조건 설정 (필드별 조건)
  - ✅ 연락처 필드 선택

- **✅ 동적 대상 그룹**
  - ✅ 커스텀 SQL 쿼리 입력
  - ✅ 쿼리 실행 테스트 및 미리보기
  - ✅ 쿼리 결과 컬럼 확인
  - ✅ 매핑용 컬럼 선택 (개인화 변수용)
  - ✅ 연락처 컬럼 선택 (발송 대상용)
  - ✅ 예상 발송 대상 수 계산

- **✅ 대상 그룹 관리**
  - ✅ 다중 대상 그룹 설정
  - ✅ 그룹별 우선순위 설정
  - ✅ 실시간 데이터 동기화

#### 5.2.3 ✅ 변수-대상 매핑 탭 - 명칭 변경 및 기능 강화
- **✅ 핵심 매핑 기능**
  - ✅ 알림톡 템플릿 변수와 대상 그룹 데이터 필드 자동 매칭
  - ✅ 변수별 데이터 소스 선택 (대상 쿼리 결과 컬럼)
  - ✅ 매핑 완성도 실시간 체크
  - ✅ 매핑 결과 미리보기

- **✅ 고급 매핑 기능**
  - ✅ 변수 쿼리 템플릿 저장/관리
  - ✅ 매핑 이력 관리 시스템
  - ✅ 자동 매핑 제안 기능
  - ✅ 매핑 설정 내보내기/가져오기

#### 5.3 ✅ 템플릿 관리
- ✅ 템플릿 빌더 (드래그&드롭, 변수 삽입)
- ✅ 템플릿 라이브러리 (카테고리별 분류)
- ✅ CoolSMS 등록 가이드
- ✅ 템플릿 내보내기/가져오기

#### 5.4 ✅ 단순 발송 도구
- ✅ SMS/LMS 즉시 발송
- ✅ 변수 치환 지원
- ✅ 빠른 템플릿 제공
- ✅ 실시간 메시지 타입 감지

### 6. 성공 지표 (KPI) - 측정 가능

#### 6.1 사용자 관련
- ✅ 워크플로우 생성 수 (Supabase 추적)
- ✅ 템플릿 사용 빈도 (사용 통계 저장)
- ✅ 변수 매핑 재사용률 (개별 저장 기능)

#### 6.2 플랫폼 성능
- ✅ 메시지 발송 성공률 (CoolSMS 응답 추적)
- ✅ 시스템 응답 시간 (쿼리 실행 시간 측정)
- ✅ 에러 로깅 및 처리

#### 6.3 비즈니스 성과
- ✅ 워크플로우당 평균 메시지 발송량
- ✅ 템플릿 활용률
- ✅ 자동화 효율성 측정

### 7. 구현 완료 현황 (2024년 1월 기준)

#### 7.1 ✅ Phase 1: 웹 애플리케이션 MVP (완료)
- **✅ 핵심 기능 개발 완료**
  - ✅ 사용자 인터페이스 및 네비게이션
  - ✅ 메시지 작성 및 템플릿 관리
  - ✅ 6단계 워크플로우 생성 기능
  - ✅ CoolSMS 알림톡 및 SMS 연동
  - ✅ 대시보드 및 통계 (Supabase 기반)

- **✅ 고급 기능 완료**
  - ✅ MySQL 연동 대상 세그멘테이션
  - ✅ 변수 매핑 자동화
  - ✅ 발송 스케줄링 및 타이밍 제어
  - ✅ 실시간 테스트 및 디버깅
  - ✅ 반응형 디자인 완성

#### 7.2 ✅ Phase 2: 데이터베이스 연동 완료
- **✅ Supabase 완전 연동**
  - ✅ 워크플로우 영구 저장
  - ✅ 변수 매핑 템플릿 관리
  - ✅ 개별 변수 저장 시스템
  - ✅ 사용 통계 및 분석

- **✅ MySQL 연동 완료**
  - ✅ 읽기 전용 쿼리 실행
  - ✅ 실시간 데이터 조회
  - ✅ 에러 처리 및 검증

#### 7.3 🔄 Phase 3: 최적화 및 확장 (진행 중)
- 🔄 성능 최적화
- 🔄 고급 분석 기능
- 🔄 사용자 경험 개선
- 🔄 API 확장

### 8. 개발 우선순위 현황

#### 8.1 ✅ 완료된 1순위 기능
- ✅ 워크플로우 빌더 (6단계 완성)
- ✅ 메시지 발송 시스템
- ✅ 데이터베이스 연동
- ✅ 템플릿 관리 시스템

#### 8.2 ✅ 완료된 2순위 기능
- ✅ 고급 변수 매핑
- ✅ 실시간 테스트 시스템
- ✅ Supabase 영구 저장
- ✅ 사용자 친화적 UI/UX

#### 8.3 🔄 진행 중인 3순위 기능
- 🔄 성능 최적화
- 🔄 고급 분석 기능
- 🔄 에러 모니터링
- 🔄 사용자 가이드 개선

### 9. 제약사항 및 고려사항

#### 9.1 기술적 제약사항
- ✅ 해결됨: CoolSMS API 연동 완료
- ✅ 해결됨: MySQL 읽기 전용 연동
- 🔄 진행 중: 대용량 발송 성능 최적화

#### 9.2 법적 고려사항
- ✅ 개인정보보호법 준수 (변수 매핑 시 주의사항 안내)
- ✅ 스팸 방지법 준수 (테스트 모드 기본 제공)
- ✅ 카카오톡 발송 정책 준수 (템플릿 가이드 제공)

#### 9.3 비즈니스 고려사항
- ✅ 메시지 발송 비용 최적화 (테스트 모드 제공)
- ✅ 사용자 친화적 인터페이스 (6단계 가이드)
- ✅ 데이터 백업 및 복구 (Supabase + localStorage)

### 10. 위험 요소 및 대응 방안

#### 10.1 기술적 위험
- **위험**: 대용량 발송 시 시스템 부하
- **대응**: ✅ 테스트 모드 제공, 🔄 단계적 발송 구현 예정

#### 10.2 외부 의존성 위험
- **위험**: CoolSMS 서비스 정책 변경
- **대응**: ✅ 다중 발신번호 지원, ✅ 대체 발송 로직 구현

#### 10.3 사용자 경험 위험
- **위험**: 복잡한 설정으로 인한 사용성 저하
- **대응**: ✅ 6단계 가이드, ✅ 실시간 미리보기, ✅ 템플릿 제공

### 11. 결론

본 PRD는 카카오톡과 문자 메시지 자동화 플랫폼의 **MVP 개발이 완료된 상태**를 반영합니다. 

#### ✅ 주요 성과:
- **완전한 워크플로우 자동화 시스템** 구축
- **MySQL + Supabase 하이브리드 DB** 연동 완료  
- **CoolSMS API 완전 연동** 및 실제 발송 가능
- **사용자 친화적 6단계 빌더** 완성
- **변수 기반 개인화 메시지** 시스템 구현

현재 플랫폼은 **실제 운영 환경에서 사용 가능한 수준**이며, 소상공인과 중소기업의 고객 소통 효율성을 극대화할 수 있는 완성된 솔루션입니다.

향후에는 성능 최적화, 고급 분석 기능, 사용자 경험 개선에 집중하여 지속적으로 발전시켜 나갈 계획입니다.