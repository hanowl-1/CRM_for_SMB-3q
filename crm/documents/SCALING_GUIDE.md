# 대규모 운영을 위한 확장성 가이드

## 현재 시스템 용량

### 기본 설정
- **배치 크기**: 50개 작업/실행
- **실행 주기**: 5분마다
- **일일 최대 처리량**: 14,400개 작업 (50 × 12 × 24)

### 대규모 운영 시나리오

#### 시나리오 1: 일일 2,000건 발송 + 100개 워크플로우
- **예상 부하**: 매우 낮음 ✅
- **필요 설정**: 기본 설정으로 충분
- **여유도**: 7배 이상
- **월간 비용**: 900,000원 (발송비만)
- **인프라 비용**: 무료

#### 시나리오 2: 일일 10,000건 발송 + 500개 워크플로우
- **예상 부하**: 낮음 ✅
- **권장 설정**: 
  - `SCHEDULER_BATCH_SIZE=100`
  - Vercel Cron 주기: 2분마다
- **여유도**: 2배 이상
- **월간 비용**: 3,900,000원 (할인 적용)
- **인프라 비용**: 45,000원/월

#### 시나리오 3: 일일 50,000건 발송 + 1,000개 워크플로우
- **예상 부하**: 높음 ⚠️
- **필요 조치**: 시스템 업그레이드 필요
- **월간 비용**: 15,000,000원 (대량 할인)
- **인프라 비용**: 45,000원/월

## 확장 방법

### 1. 환경변수 설정
```bash
# Vercel 환경변수에 추가
SCHEDULER_BATCH_SIZE=100  # 배치 크기 증가
```

### 2. Vercel Cron 주기 조정
```json
{
  "crons": [
    {
      "path": "/api/scheduler/cron",
      "schedule": "*/1 * * * *"  // 1분마다 실행 (고부하 시)
    }
  ]
}
```

### 3. Vercel Pro 업그레이드
- **함수 실행 시간**: 최대 900초
- **메모리**: 최대 3GB
- **동시 실행**: 무제한
- **비용**: $20/월 (약 26,000원)

### 4. 병렬 처리 구현
```typescript
// 워크플로우 병렬 실행
await Promise.all(
  jobs.map(job => this.executeJob(job))
);
```

## 📊 실제 운영 비용 상세 분석

### 💰 월간 운영비 계산 (일일 2,000건 기준)

#### 필수 비용
```
📱 CoolSMS (알림톡): 60,000건 × 15원 = 900,000원
🌐 Vercel Cron: 무료 (Hobby 플랜 포함)
🌐 Vercel: 무료 (Hobby 플랜)
🌐 Supabase: 무료 (50만 요청 한도 내)
💰 총 필수 비용: 900,000원/월
```

#### 선택적 업그레이드 비용
```
🚀 Vercel Pro: $20/월 (약 26,000원) - 고성능 함수
🗄️ Supabase Pro: $25/월 (약 32,500원) - 확장된 DB
💰 총 업그레이드 비용: 58,500원/월
```

#### 규모별 총 운영비
```
🟢 기본 운영 (2,000건/일): 900,000원/월
🟡 안정화 운영 (2,000건/일): 958,500원/월
🟠 대규모 운영 (10,000건/일): 3,945,000원/월
🔴 초대규모 운영 (50,000건/일): 15,045,000원/월
```

### 📈 비용 대비 효과 분석

#### ROI 계산 (기존 수동 vs 자동화)
```
기존 수동 발송 비용:
👤 인건비: 1,800,000원/월 (4시간/일 × 30일 × 15,000원)
📱 발송비: 900,000원/월
💰 총 비용: 2,700,000원/월

자동화 시스템 비용:
🤖 발송비: 900,000원/월
👤 관리비: 30,000원/월 (2시간/월 × 15,000원)
💰 총 비용: 930,000원/월

💡 절약 효과: 1,770,000원/월 (66% 절약)
📊 연간 절약: 21,240,000원
```

## 모니터링

### 성능 지표
- **처리량**: 분당 처리된 작업 수
- **실행 시간**: 평균 함수 실행 시간
- **실패율**: 실패한 작업 비율
- **대기 시간**: 예약 시간과 실제 실행 시간 차이

### 비용 모니터링 지표
- **일일 발송량**: 예산 대비 사용량
- **건당 비용**: 실제 발송 단가
- **성공률**: 재발송으로 인한 추가 비용
- **인프라 사용률**: 무료 한도 대비 사용량

### 알림 설정
- **실패 임계값**: 연속 3회 실패 시 알림
- **지연 임계값**: 10분 이상 지연 시 알림
- **용량 임계값**: 대기 작업 100개 이상 시 알림
- **비용 임계값**: 일일 예산 80% 도달 시 알림

## 비용 최적화

### Vercel 요금제
- **Hobby**: 무료, 2개 Cron 작업 포함 ✅ **현재 사용**
- **Pro**: $20/월, 40개 Cron 작업, 고성능 (대규모 시 필요)
- **Enterprise**: 맞춤형 (초대규모 시 필요)

### CoolSMS 비용 절약 전략
```
📊 발송량별 할인 협상:
- 월 10만건 이상: 13원/건 (13% 할인)
- 월 50만건 이상: 10원/건 (33% 할인)
- 월 100만건 이상: 8원/건 (47% 할인)

🎯 추가 절약 방법:
- 발송 시간 최적화: 성공률 향상
- 타겟팅 정확도 개선: 무효 발송 최소화
- SMS 대체 전략: 실패 시에만 SMS 사용
```

### 예산 계획 가이드
```
📋 월간 예산 수립:
1. 목표 발송량 설정
2. 단가 협상 (대량 할인)
3. 인프라 비용 검토
4. 비상 예산 (20%) 확보

📊 분기별 검토:
- Q1: 시스템 안정화
- Q2: 효율성 개선
- Q3: 규모 확장
- Q4: 차년도 계획
```

## 장애 대응

### 일반적인 문제
1. **타임아웃**: 배치 크기 줄이기
2. **메모리 부족**: Vercel Pro 업그레이드
3. **API 제한**: CoolSMS 요청 간격 조정
4. **DB 연결**: Supabase 연결 풀 최적화
5. **예산 초과**: 일일 발송 한도 설정

### 백업 계획
1. **다중 cron 서비스**: EasyCron, GitHub Actions
2. **수동 실행**: 웹 인터페이스에서 즉시 실행
3. **로그 모니터링**: 실시간 상태 확인
4. **비용 알림**: 예산 초과 방지

### 비상 대응 절차
```
🚨 비상 상황 시 대응:
1. 즉시 발송 중단
2. 원인 분석 및 해결
3. 부분 재시작
4. 전체 시스템 복구
5. 사후 분석 및 개선
```

## 결론

현재 시스템은 **일일 2,000건 + 100개 워크플로우**를 여유롭게 처리할 수 있습니다.

### 핵심 장점
- ✅ **비용 효율성**: 기존 대비 66% 비용 절약
- ✅ **확장성**: 필요 시 쉽게 규모 확장 가능
- ✅ **안정성**: 완전 독립적 운영
- ✅ **모니터링**: 실시간 상태 및 비용 추적

### 권장 사항
1. **초기**: 무료 플랜으로 시작
2. **안정화**: 월 100만원 예산으로 운영
3. **확장**: 필요 시 단계적 업그레이드
4. **최적화**: 지속적인 비용 모니터링

더 큰 규모가 필요한 경우 위의 확장 방법을 단계적으로 적용하세요. 