openapi: 3.0.3
info:
  title: CRM ì‹œìŠ¤í…œ API
  description: |
    **ë§ˆì¼€íŒ… ìë™í™” CRM ì‹œìŠ¤í…œ**ì˜ ë°±ì—”ë“œ API ëª…ì„¸ì„œì…ë‹ˆë‹¤.
    
    ### ê¸°ìˆ  ìŠ¤íƒ
    - **í”„ë ˆì„ì›Œí¬**: Next.js 15 (App Router)
    - **ë°ì´í„°ë² ì´ìŠ¤**: Supabase (ë©”íƒ€ë°ì´í„°), MySQL (ë¹„ì¦ˆë‹ˆìŠ¤ ë°ì´í„°)
    - **ë©”ì‹œì§•**: CoolSMS API
    - **ìŠ¤ì¼€ì¤„ë§**: AWS Lambda + Vercel Cron
    
    ### ì¤‘ìš” ì°¸ê³ ì‚¬í•­
    - **ìŠ¤ì¼€ì¤„ í•„ë“œ**: `schedule_config` ì‚¬ìš© (legacy `schedule_settings`ëŠ” í•˜ìœ„í˜¸í™˜ì„±ë§Œ ì§€ì›)
    - **ì›Œí¬í”Œë¡œìš°**: 3ë‹¨ê³„ êµ¬ì¡° (target_config, message_config, mapping_config)
    - **í…ŒìŠ¤íŠ¸ ëª¨ë“œ**: ê°œë°œ í™˜ê²½ì—ì„œ ì‹¤ì œ ë©”ì‹œì§€ ë°œì†¡ ì—†ì´ ì‹œë®¬ë ˆì´ì…˜ ê°€ëŠ¥
  version: 1.0.0
  contact:
    name: CRM API Support
  license:
    name: MIT

servers:
  - url: http://localhost:3000
    description: Development server
  - url: https://your-domain.vercel.app
    description: Production server

tags:
  - name: Workflows
    description: ì›Œí¬í”Œë¡œìš° ê´€ë¦¬
  - name: Messaging
    description: ë©”ì‹œì§• ì„œë¹„ìŠ¤
  - name: Database
    description: ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™
  - name: Scheduler
    description: ìŠ¤ì¼€ì¤„ëŸ¬ ì‹œìŠ¤í…œ
  - name: Webhooks
    description: ì›¹í›… ì‹œìŠ¤í…œ
  - name: Templates
    description: í…œí”Œë¦¿ ê´€ë¦¬
  - name: Supabase
    description: Supabase ë°ì´í„° ê´€ë¦¬
  - name: Campaigns
    description: ìº í˜ì¸ ê´€ë¦¬
  - name: System
    description: ì‹œìŠ¤í…œ ê´€ë¦¬
  - name: Queries
    description: ì¿¼ë¦¬ ë° ë§¤í•‘
  - name: Cron
    description: í¬ë¡  ì‘ì—…
  - name: Auth
    description: ì¸ì¦

components:
  schemas:
    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "ì‘ì—… ì™„ë£Œ ë©”ì‹œì§€"
        data:
          type: object
        timestamp:
          type: string
          format: date-time
          example: "2025-07-29T09:06:32.946Z"
    
    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: "ì—ëŸ¬ ë©”ì‹œì§€"
        error:
          type: string
          example: "ìƒì„¸ ì—ëŸ¬ ì •ë³´"
    
    Workflow:
      type: object
      properties:
        id:
          type: string
          example: "550e8400-e29b-41d4-a716-446655440000"
        name:
          type: string
          example: "ë¦¬ë·° ìš”ì²­ ì›Œí¬í”Œë¡œìš°"
        description:
          type: string
          example: "ê³ ê°ì—ê²Œ ë¦¬ë·° ìš”ì²­ ë©”ì‹œì§€ë¥¼ ë°œì†¡í•˜ëŠ” ì›Œí¬í”Œë¡œìš°"
        status:
          type: string
          enum: [draft, active, paused, archived]
          example: "active"
        trigger_type:
          type: string
          enum: [manual, webhook]
          example: "manual"
          description: "íŠ¸ë¦¬ê±° íƒ€ì… (manual: ì‚¬ìš©ì ê´€ë¦¬, webhook: ì´ë²¤íŠ¸ ê¸°ë°˜)"
        trigger_config:
          type: object
          description: "íŠ¸ë¦¬ê±° ì„¤ì •"
        target_config:
          type: object
          description: "ëŒ€ìƒ ì„¤ì • (manual íƒ€ì…ì—ì„œë§Œ ì‚¬ìš©)"
        message_config:
          type: object
          description: "ë©”ì‹œì§€ ì„¤ì •"
        mapping_config:
          type: object
          description: "ë§¤í•‘ ì„¤ì •"
        schedule_config:
          $ref: '#/components/schemas/ScheduleConfig'
        variables:
          type: object
          description: "ë³€ìˆ˜ ì„¤ì •"
        statistics:
          type: object
          description: "ì‹¤í–‰ í†µê³„"
        last_run_at:
          type: string
          format: date-time
          example: "2025-07-29T00:00:00Z"
          description: "ë§ˆì§€ë§‰ ì‹¤í–‰ ì‹œê°„"
        next_run_at:
          type: string
          format: date-time
          example: "2025-07-30T09:00:00Z"
          description: "ë‹¤ìŒ ì‹¤í–‰ ì˜ˆì • ì‹œê°„"
        created_by:
          type: string
          example: "user"
          description: "ìƒì„±ì"
        created_at:
          type: string
          format: date-time
          example: "2025-07-29T00:00:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2025-07-29T12:00:00Z"

    SMSRequest:
      type: object
      required:
        - to
        - message
      properties:
        to:
          type: string
          example: "010-1234-5678"
          description: "ìˆ˜ì‹  ì „í™”ë²ˆí˜¸"
        message:
          type: string
          example: "ë©”ì‹œì§€ ë‚´ìš©"
          description: "ë°œì†¡í•  ë©”ì‹œì§€"
        from:
          type: string
          example: "ë°œì‹ ë²ˆí˜¸"
          description: "ë°œì‹  ì „í™”ë²ˆí˜¸"
        enableRealSending:
          type: boolean
          example: false
          description: "ì‹¤ì œ ë°œì†¡ ì—¬ë¶€"
        variables:
          type: object
          additionalProperties:
            type: string
          example:
            name: "í™ê¸¸ë™"
            company: "íšŒì‚¬ëª…"

    QueryRequest:
      type: object
      required:
        - query
      properties:
        query:
          type: string
          example: "SELECT * FROM table_name LIMIT 10"
          description: "ì‹¤í–‰í•  SQL ì¿¼ë¦¬ (SELECTë§Œ í—ˆìš©)"
        limit:
          type: integer
          example: 1000
          maximum: 50000
          description: "ê²°ê³¼ í–‰ ì œí•œ"

    WebhookEvent:
      type: object
      description: "ì›¹í›… ì´ë²¤íŠ¸ ë°ì´í„° (í•µì‹¬ í•„ë“œë§Œ ì •ì˜, ì¶”ê°€ í•„ë“œ ììœ ë¡­ê²Œ ì „ì†¡ ê°€ëŠ¥)"
      required:
        - phone
      properties:
        phone:
          type: string
          example: "010-1234-5678"
          description: "ìˆ˜ì‹ ì ì „í™”ë²ˆí˜¸ (í•„ìˆ˜) - phoneNumber, contactë¡œë„ ì „ë‹¬ ê°€ëŠ¥"
        company:
          type: string
          example: "íšŒì‚¬ëª…"
          description: "íšŒì‚¬ëª…/ì´ë¦„ (ê¶Œì¥)"
        email:
          type: string
          format: email
          example: "test@example.com"
          description: "ì´ë©”ì¼ ì£¼ì†Œ (ì„ íƒì )"
      additionalProperties: true
      examples:
        minimal:
          summary: "ìµœì†Œ í•„ìˆ˜ í•„ë“œ"
          value:
            phone: "010-1234-5678"
            company: "í…ŒìŠ¤íŠ¸ íšŒì‚¬"
        with_email:
          summary: "ì´ë©”ì¼ í¬í•¨"
          value:
            phone: "010-1234-5678"
            company: "ABC íšŒì‚¬"
            email: "test@abc.com"

    ScheduleConfig:
      type: object
      description: "ìŠ¤ì¼€ì¤„ ì„¤ì • (í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ í•„ë“œ)"
      required:
        - type
        - timezone
      properties:
        type:
          type: string
          enum: [immediate, delay, scheduled, recurring]
          example: "immediate"
          description: "ìŠ¤ì¼€ì¤„ ì‹¤í–‰ íƒ€ì…"
        timezone:
          type: string
          example: "Asia/Seoul"
          description: "ì‹œê°„ëŒ€ ì„¤ì • (ëª¨ë“  íƒ€ì…ì— í•„ìˆ˜)"
        delay:
          type: integer
          description: "ì§€ì—° ì‹œê°„ (ë¶„ ë‹¨ìœ„, typeì´ 'delay'ì¼ ë•Œ í•„ìˆ˜)"
          example: 60
        scheduledTime:
          type: string
          description: "ì˜ˆì•½ ì‹¤í–‰ ì‹œê°„ (typeì´ 'scheduled'ì¼ ë•Œ í•„ìˆ˜)"
          example: "2025-01-30T14:35:00+09:00"
        recurringPattern:
          type: object
          description: "ë°˜ë³µ íŒ¨í„´ ì„¤ì • (typeì´ 'recurring'ì¼ ë•Œ í•„ìˆ˜)"
          required:
            - frequency
            - interval
            - time
          properties:
            frequency:
              type: string
              enum: [daily, weekly, monthly]
              example: "daily"
            interval:
              type: integer
              example: 1
              description: "ë°˜ë³µ ê°„ê²©"
            time:
              type: string
              pattern: "^[0-2][0-9]:[0-5][0-9]$"
              example: "14:35"
              description: "ì‹¤í–‰ ì‹œê°„ (HH:MM í˜•ì‹)"
            daysOfWeek:
              type: array
              items:
                type: integer
                minimum: 0
                maximum: 6
              description: "ìš”ì¼ ì„¤ì • (0=ì¼ìš”ì¼, 1=ì›”ìš”ì¼, ..., weeklyì¼ ë•Œ ì„ íƒì‚¬í•­)"
            dayOfMonth:
              type: integer
              minimum: 1
              maximum: 31
              description: "ì›”ì˜ íŠ¹ì • ì¼ (monthlyì¼ ë•Œ ì„ íƒì‚¬í•­)"
      examples:
        immediate:
          summary: "ì¦‰ì‹œ ì‹¤í–‰"
          value:
            type: "immediate"
            timezone: "Asia/Seoul"
        delay:
          summary: "ì§€ì—° ì‹¤í–‰"
          value:
            type: "delay"
            delay: 60
            timezone: "Asia/Seoul"
        recurring_daily:
          summary: "ë§¤ì¼ ë°˜ë³µ"
          value:
            type: "recurring"
            timezone: "Asia/Seoul"
            recurringPattern:
              time: "14:35"
              interval: 1
              frequency: "daily"

paths:
  # Workflows
  /api/supabase/workflows:
    get:
      tags: [Workflows]
      summary: ì›Œí¬í”Œë¡œìš° ëª©ë¡ ì¡°íšŒ
      description: |
        í˜ì´ì§€ë„¤ì´ì…˜, í•„í„°ë§, ê²€ìƒ‰ ê¸°ëŠ¥ì„ ì§€ì›í•˜ëŠ” ì›Œí¬í”Œë¡œìš° ëª©ë¡ ì¡°íšŒ APIì…ë‹ˆë‹¤.
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
          description: "í˜ì´ì§€ ë²ˆí˜¸"
          example: 1
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          description: "í˜ì´ì§€ë‹¹ í•­ëª© ìˆ˜ (ìµœëŒ€ 100ê°œ)"
          example: 20
        - name: status
          in: query
          schema:
            type: string
            enum: [draft, active, paused, archived]
          description: "ìƒíƒœë³„ í•„í„°ë§"
          example: "active"
        - name: trigger_type
          in: query
          schema:
            type: string
            enum: [manual, webhook]
          description: "íŠ¸ë¦¬ê±° íƒ€ì…ë³„ í•„í„°ë§"
          example: "manual"
        - name: search
          in: query
          schema:
            type: string
          description: "ì´ë¦„ ë˜ëŠ” ì„¤ëª…ì—ì„œ ê²€ìƒ‰í•  í‚¤ì›Œë“œ"
          example: "ë¦¬ë·°"
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Workflow'
                  meta:
                    type: object
                    properties:
                      total:
                        type: integer
                        description: "ì „ì²´ í•­ëª© ìˆ˜"
                        example: 150
                      page:
                        type: integer
                        description: "í˜„ì¬ í˜ì´ì§€"
                        example: 1
                      limit:
                        type: integer
                        description: "í˜ì´ì§€ë‹¹ í•­ëª© ìˆ˜"
                        example: 20
                      totalPages:
                        type: integer
                        description: "ì „ì²´ í˜ì´ì§€ ìˆ˜"
                        example: 8
        '500':
          description: ì„œë²„ ì˜¤ë¥˜
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      tags: [Workflows]
      summary: ìƒˆ ì›Œí¬í”Œë¡œìš° ìƒì„±
      description: |
        ìƒˆë¡œìš´ ì›Œí¬í”Œë¡œìš°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ì›Œí¬í”Œë¡œìš° íƒ€ì…ì— ë”°ë¼ ì €ì¥ë˜ëŠ” í•„ë“œê°€ ë‹¤ë¦…ë‹ˆë‹¤.
        - **webhook**: trigger_configë§Œ ì €ì¥, target_config ì œì™¸
        - **manual**: target_config í¬í•¨
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  minLength: 1
                  description: "ì›Œí¬í”Œë¡œìš° ì´ë¦„ (í•„ìˆ˜)"
                  example: "ë¦¬ë·° ìš”ì²­ ì›Œí¬í”Œë¡œìš°"
                description:
                  type: string
                  description: "ì›Œí¬í”Œë¡œìš° ì„¤ëª…"
                  example: "ê³ ê°ì—ê²Œ ë¦¬ë·° ìš”ì²­ ë©”ì‹œì§€ë¥¼ ë°œì†¡í•˜ëŠ” ì›Œí¬í”Œë¡œìš°"
                trigger_type:
                  type: string
                  enum: [manual, webhook]
                  default: "manual"
                  description: "íŠ¸ë¦¬ê±° íƒ€ì… (manual: ì‚¬ìš©ì ê´€ë¦¬, webhook: ì´ë²¤íŠ¸ ê¸°ë°˜)"
                  example: "manual"
                status:
                  type: string
                  enum: [draft, active, paused, archived]
                  default: "draft"
                  description: "ì›Œí¬í”Œë¡œìš° ìƒíƒœ"
                  example: "draft"
                message_config:
                  type: object
                  description: "ë©”ì‹œì§€ ì„¤ì •"
                  properties:
                    steps:
                      type: array
                      items:
                        type: object
                      description: "ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ë‹¨ê³„ë“¤"
                      example: []
                    selectedTemplates:
                      type: array
                      items:
                        type: object
                      description: "ì„ íƒëœ ë©”ì‹œì§€ í…œí”Œë¦¿ë“¤"
                      example: []
                target_config:
                  type: object
                  description: "ëŒ€ìƒ ì„¤ì • (manual íƒ€ì…ì—ì„œë§Œ ì‚¬ìš©)"
                  properties:
                    targetGroups:
                      type: array
                      items:
                        type: object
                      description: "ëŒ€ìƒ ê·¸ë£¹ ì„¤ì •"
                      example: []
                    targetTemplateMappings:
                      type: array
                      items:
                        type: object
                      description: "ëŒ€ìƒ-í…œí”Œë¦¿ ë§¤í•‘ ì„¤ì •"
                      example: []
                variables:
                  type: object
                  description: "ë³€ìˆ˜ ì„¤ì •"
                  properties:
                    templatePersonalizations:
                      type: object
                      description: "í…œí”Œë¦¿ ê°œì¸í™” ì„¤ì •"
                      example: {}
                    testSettings:
                      type: object
                      description: "í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì„¤ì •"
                      example: {}
                schedule_config:
                  $ref: '#/components/schemas/ScheduleConfig'
                trigger_config:
                  type: object
                  description: "íŠ¸ë¦¬ê±° ì„¤ì • (webhook íƒ€ì…ì—ì„œ ì£¼ë¡œ ì‚¬ìš©)"
                  example: {}
                created_by:
                  type: string
                  default: "user"
                  description: "ìƒì„±ì"
                  example: "user"
      responses:
        '201':
          description: ìƒì„± ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Workflow'
        '400':
          description: ì˜ëª»ëœ ìš”ì²­
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    examples:
                      - "Workflow name is required"
                      - "Invalid trigger type. Only \"manual\" and \"webhook\" are supported."
                      - "Webhook workflows only support \"immediate\" and \"delay\" schedule types."
                      - "Invalid status"
        '500':
          description: ì„œë²„ ì˜¤ë¥˜
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/supabase/workflows/{id}:
    get:
      tags: [Workflows]
      summary: ë‹¨ì¼ ì›Œí¬í”Œë¡œìš° ì¡°íšŒ
      description: "íŠ¹ì • ì›Œí¬í”Œë¡œìš°ì˜ ìƒì„¸ ì •ë³´ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤."
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: "ì›Œí¬í”Œë¡œìš° ID"
          example: "550e8400-e29b-41d4-a716-446655440000"
      responses:
        '200':
          description: ì¡°íšŒ ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Workflow'
        '404':
          description: ì›Œí¬í”Œë¡œìš°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "Workflow not found"
        '500':
          description: ì„œë²„ ì˜¤ë¥˜
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      tags: [Workflows]
      summary: ì›Œí¬í”Œë¡œìš° ì „ì²´ ìˆ˜ì •
      description: |
        ì›Œí¬í”Œë¡œìš°ì˜ ì „ì²´ ë˜ëŠ” ë¶€ë¶„ ì •ë³´ë¥¼ ìˆ˜ì •í•©ë‹ˆë‹¤.
        ì›Œí¬í”Œë¡œìš° íƒ€ì…ì— ë”°ë¼ ìˆ˜ì • ê°€ëŠ¥í•œ í•„ë“œê°€ ë‹¤ë¦…ë‹ˆë‹¤.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: "ì›Œí¬í”Œë¡œìš° ID"
          example: "550e8400-e29b-41d4-a716-446655440000"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  description: "ì›Œí¬í”Œë¡œìš° ì´ë¦„"
                  example: "ìˆ˜ì •ëœ ì›Œí¬í”Œë¡œìš° ì´ë¦„"
                description:
                  type: string
                  description: "ì›Œí¬í”Œë¡œìš° ì„¤ëª…"
                trigger_type:
                  type: string
                  enum: [manual, webhook]
                  description: "íŠ¸ë¦¬ê±° íƒ€ì… (manual: ì‚¬ìš©ì ê´€ë¦¬, webhook: ì´ë²¤íŠ¸ ê¸°ë°˜)"
                status:
                  type: string
                  enum: [draft, active, paused, archived]
                  description: "ì›Œí¬í”Œë¡œìš° ìƒíƒœ"
                message_config:
                  type: object
                  description: "ë©”ì‹œì§€ ì„¤ì •"
                  properties:
                    steps:
                      type: array
                      items:
                        type: object
                      description: "ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ë‹¨ê³„ë“¤"
                      example: []
                    selectedTemplates:
                      type: array
                      items:
                        type: object
                      description: "ì„ íƒëœ ë©”ì‹œì§€ í…œí”Œë¦¿ë“¤"
                      example: []
                target_config:
                  type: object
                  description: "ëŒ€ìƒ ì„¤ì • (manual íƒ€ì…ì—ì„œë§Œ ì‚¬ìš©)"
                  properties:
                    targetGroups:
                      type: array
                      items:
                        type: object
                      description: "ëŒ€ìƒ ê·¸ë£¹ ì„¤ì •"
                      example: []
                    targetTemplateMappings:
                      type: array
                      items:
                        type: object
                      description: "ëŒ€ìƒ-í…œí”Œë¦¿ ë§¤í•‘ ì„¤ì •"
                      example: []
                variables:
                  type: object
                  description: "ë³€ìˆ˜ ì„¤ì •"
                  properties:
                    templatePersonalizations:
                      type: object
                      description: "í…œí”Œë¦¿ ê°œì¸í™” ì„¤ì •"
                      example: {}
                    testSettings:
                      type: object
                      description: "í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì„¤ì •"
                      example: {}
                schedule_config:
                  $ref: '#/components/schemas/ScheduleConfig'
                trigger_config:
                  type: object
                  description: "íŠ¸ë¦¬ê±° ì„¤ì • (webhook íƒ€ì…ì—ì„œ ì£¼ë¡œ ì‚¬ìš©)"
                  example: {}
      responses:
        '200':
          description: ìˆ˜ì • ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Workflow'
        '400':
          description: ì˜ëª»ëœ ìš”ì²­
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "Workflow name cannot be empty"
        '404':
          description: ì›Œí¬í”Œë¡œìš°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "Workflow not found"
        '500':
          description: ì„œë²„ ì˜¤ë¥˜
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    patch:
      tags: [Workflows]
      summary: ì›Œí¬í”Œë¡œìš° ìƒíƒœ ë³€ê²½
      description: |
        ì›Œí¬í”Œë¡œìš°ì˜ ìƒíƒœë¥¼ ë³€ê²½í•©ë‹ˆë‹¤. 
        ìƒíƒœê°€ 'paused' ë˜ëŠ” 'archived'ë¡œ ë³€ê²½ë˜ë©´ ê´€ë ¨ëœ ìŠ¤ì¼€ì¤„ ì‘ì—…ë“¤ì´ ìë™ìœ¼ë¡œ ì·¨ì†Œë©ë‹ˆë‹¤.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: "ì›Œí¬í”Œë¡œìš° ID"
          example: "550e8400-e29b-41d4-a716-446655440000"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - status
              properties:
                status:
                  type: string
                  enum: [draft, active, paused, archived]
                  description: "ë³€ê²½í•  ìƒíƒœ"
                  example: "active"
      responses:
        '200':
          description: ìƒíƒœ ë³€ê²½ ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Workflow'
                  message:
                    type: string
                    examples:
                      - "ì›Œí¬í”Œë¡œìš°ê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤."
                      - "ì›Œí¬í”Œë¡œìš°ê°€ ì¼ì‹œì •ì§€ë˜ì—ˆìŠµë‹ˆë‹¤."
                      - "ì›Œí¬í”Œë¡œìš°ê°€ ë³´ê´€ë˜ì—ˆìŠµë‹ˆë‹¤."
        '400':
          description: ì˜ëª»ëœ ìš”ì²­
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    examples:
                      - "Status is required for PATCH operation"
                      - "Invalid status"
        '404':
          description: ì›Œí¬í”Œë¡œìš°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "Workflow not found"
        '500':
          description: ì„œë²„ ì˜¤ë¥˜
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags: [Workflows]
      summary: ì›Œí¬í”Œë¡œìš° ì‚­ì œ
      description: |
        ì›Œí¬í”Œë¡œìš°ë¥¼ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œí•©ë‹ˆë‹¤.
        CASCADE ì„¤ì •ìœ¼ë¡œ ì¸í•´ ê´€ë ¨ëœ scheduled_jobsë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: "ì›Œí¬í”Œë¡œìš° ID"
          example: "550e8400-e29b-41d4-a716-446655440000"
      responses:
        '200':
          description: ì‚­ì œ ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "ì›Œí¬í”Œë¡œìš° 'ë¦¬ë·° ìš”ì²­ ì›Œí¬í”Œë¡œìš°'ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤."
        '404':
          description: ì›Œí¬í”Œë¡œìš°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "Workflow not found"
        '500':
          description: ì„œë²„ ì˜¤ë¥˜
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/workflow/execute:
    post:
      tags: [Workflows]
      summary: ì›Œí¬í”Œë¡œìš° ì‹¤í–‰
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - workflowId
              properties:
                workflow:
                  type: object
                workflowId:
                  type: string
                  example: "workflow_123"
                scheduledExecution:
                  type: boolean
                  example: false
                jobId:
                  type: string
                  example: "job_123"
                scheduledJobId:
                  type: string
                  example: "scheduled_123"
                enableRealSending:
                  type: boolean
                  example: false
      responses:
        '200':
          description: ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /api/workflow/preview:
    post:
      tags: [Workflows]
      summary: ì›Œí¬í”Œë¡œìš° ë¯¸ë¦¬ë³´ê¸° ìƒì„±
      description: |
        **ì €ì¥ë˜ì§€ ì•Šì€ ì›Œí¬í”Œë¡œìš° ì„¤ì •**ìœ¼ë¡œ ì‹¤ì œ ë©”ì‹œì§€ ë°œì†¡ ì „ ë¯¸ë¦¬ë³´ê¸°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
        
        ### í•µì‹¬ ê¸°ëŠ¥
        - **ì„ì‹œ ì„¤ì •**: DBì— ì €ì¥í•˜ì§€ ì•Šì€ ì›Œí¬í”Œë¡œìš° ì„¤ì •ìœ¼ë¡œ ì‹œë®¬ë ˆì´ì…˜
        - **ì‹¤ì œ SQL ì‹¤í–‰**: ì‚¬ìš©ìê°€ ì‘ì„±í•œ ëŒ€ìƒì ì¿¼ë¦¬ë¥¼ ì‹¤ì œ DBì—ì„œ ì‹¤í–‰
        - **ë³€ìˆ˜ ë§¤í•‘**: ê°œë³„ ë³€ìˆ˜ ì¿¼ë¦¬ ì‹¤í–‰ í›„ ê³ ê°ë³„ ë°ì´í„° ë§¤ì¹­
        - **í…œí”Œë¦¿ ë Œë”ë§**: ê°œì¸í™”ëœ ë©”ì‹œì§€ ìƒì„±
        
        ### ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤
        1. ì›Œí¬í”Œë¡œìš° ë¹Œë”ì—ì„œ ì„¤ì • ì‘ì„± ì¤‘
        2. "ë¯¸ë¦¬ë³´ê¸°" ë²„íŠ¼ í´ë¦­ (ì•„ì§ ì €ì¥í•˜ì§€ ì•ŠìŒ)  
        3. í˜„ì¬ ì‘ì„± ì¤‘ì¸ ëª¨ë“  ì„¤ì •ì„ APIì— ì „ë‹¬
        4. ì‹¤ì œ ê³ ê° ë°ì´í„°ë¡œ ê°œì¸í™”ëœ ë©”ì‹œì§€ ë¯¸ë¦¬ë³´ê¸° í™•ì¸
        5. í™•ì¸ í›„ ì €ì¥ ì—¬ë¶€ ê²°ì •
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - targetGroups
                - templates
              properties:
                targetGroups:
                  type: array
                  description: "ëŒ€ìƒ ê·¸ë£¹ ì„¤ì • (ë™ì  SQL ì¿¼ë¦¬ í¬í•¨)"
                  items:
                    type: object
                    properties:
                      id:
                        type: string
                        example: "temp_group_1"
                      name:
                        type: string
                        example: "VIP ê³ ê°"
                      type:
                        type: string
                        enum: [dynamic, static]
                        example: "dynamic"
                      dynamicQuery:
                        type: object
                        properties:
                          sql:
                            type: string
                            example: "SELECT id, name, phone, company_name FROM customers WHERE grade='VIP' LIMIT 5"
                            description: "ëŒ€ìƒì ì¡°íšŒ SQL (SELECTë§Œ í—ˆìš©)"
                templates:
                  type: array
                  description: "ì„ íƒëœ ë©”ì‹œì§€ í…œí”Œë¦¿ë“¤"
                  items:
                    type: object
                    properties:
                      id:
                        type: string
                        example: "template_123"
                      templateName:
                        type: string
                        example: "ë¦¬ë·° ê°ì‚¬ ë©”ì‹œì§€"
                      templateCode:
                        type: string
                        example: "TK_001"
                      content:
                        type: string
                        example: "ì•ˆë…•í•˜ì„¸ìš” #{company_name}ë‹˜! ì´ #{total_reviews}ê°œ ë¦¬ë·° ê°ì‚¬í•©ë‹ˆë‹¤."
                templatePersonalizations:
                  type: object
                  description: "í…œí”Œë¦¿ë³„ ê°œì¸í™” ì„¤ì •"
                  additionalProperties:
                    type: object
                    properties:
                      variableMappings:
                        type: array
                        items:
                          type: object
                          properties:
                            templateVariable:
                              type: string
                              example: "#{company_name}"
                            targetField:
                              type: string
                              example: "company_name"
                            defaultValue:
                              type: string
                              example: "ê³ ê°"
                targetTemplateMappings:
                  type: array
                  description: "ëŒ€ìƒ ê·¸ë£¹ê³¼ í…œí”Œë¦¿ ë§¤í•‘ ì„¤ì •"
                  items:
                    type: object
                    properties:
                      targetGroupId:
                        type: string
                        example: "temp_group_1"
                      templateId:
                        type: string
                        example: "template_123"
                      fieldMappings:
                        type: array
                        items:
                          type: object
                limit:
                  type: integer
                  default: 5
                  minimum: 1
                  maximum: 10
                  description: "ë¯¸ë¦¬ë³´ê¸°í•  ì—°ë½ì²˜ ìˆ˜ (ìµœëŒ€ 10ëª…)"
                  example: 5
      responses:
        '200':
          description: ë¯¸ë¦¬ë³´ê¸° ìƒì„± ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    description: "ê³ ê°ë³„ ê°œì¸í™”ëœ ë©”ì‹œì§€ ë¯¸ë¦¬ë³´ê¸°"
                    items:
                      type: object
                      properties:
                        groupName:
                          type: string
                          example: "VIP ê³ ê°"
                        contact:
                          type: object
                          properties:
                            id:
                              type: string
                              example: "1"
                            name:
                              type: string
                              example: "ê¹€ì² ìˆ˜"
                            phone:
                              type: string
                              example: "010-1234-5678"
                            email:
                              type: string
                              example: "kim@example.com"
                            company:
                              type: string
                              example: "ABCíšŒì‚¬"
                            customFields:
                              type: object
                              description: "ì¶”ê°€ ê³ ê° ì •ë³´"
                        messages:
                          type: array
                          description: "í•´ë‹¹ ê³ ê°ì—ê²Œ ë°œì†¡ë  ë©”ì‹œì§€ë“¤"
                          items:
                            type: object
                            properties:
                              templateId:
                                type: string
                                example: "template_123"
                              templateName:
                                type: string
                                example: "ë¦¬ë·° ê°ì‚¬ ë©”ì‹œì§€"
                              templateCode:
                                type: string
                                example: "TK_001"
                              originalContent:
                                type: string
                                example: "ì•ˆë…•í•˜ì„¸ìš” #{company_name}ë‹˜! ì´ #{total_reviews}ê°œ ë¦¬ë·° ê°ì‚¬í•©ë‹ˆë‹¤."
                              processedContent:
                                type: string
                                example: "ì•ˆë…•í•˜ì„¸ìš” ABCíšŒì‚¬ë‹˜! ì´ 127ê°œ ë¦¬ë·° ê°ì‚¬í•©ë‹ˆë‹¤."
                              variables:
                                type: object
                                description: "í•´ë‹¹ ê³ ê°ì—ê²Œ ì ìš©ëœ ë³€ìˆ˜ë“¤"
                                example:
                                  company_name: "ABCíšŒì‚¬"
                                  total_reviews: "127"
                              characterCount:
                                type: integer
                                example: 35
                                description: "ì²˜ë¦¬ëœ ë©”ì‹œì§€ì˜ ê¸€ì ìˆ˜"
                  totalEstimatedCount:
                    type: integer
                    example: 5
                    description: "ì´ ë¯¸ë¦¬ë³´ê¸° ì—°ë½ì²˜ ìˆ˜"
                  debug:
                    type: object
                    description: "ë””ë²„ê·¸ ì •ë³´"
                    properties:
                      savedMappingsCount:
                        type: integer
                        example: 3
                        description: "ì‚¬ìš©ëœ ë³€ìˆ˜ ë§¤í•‘ ìˆ˜"
                      variableCacheSize:
                        type: integer
                        example: 3
                        description: "ìºì‹œëœ ë³€ìˆ˜ ìˆ˜"
                      templatesLoaded:
                        type: integer
                        example: 1
                        description: "ë¡œë“œëœ í…œí”Œë¦¿ ìˆ˜"
                      realTemplatesFound:
                        type: integer
                        example: 1
                        description: "ì‹¤ì œ í…œí”Œë¦¿ ë°ì´í„°ê°€ ë°œê²¬ëœ ìˆ˜"
                      totalCachedRows:
                        type: integer
                        example: 150
                        description: "ìºì‹œëœ ì´ ë°ì´í„° í–‰ ìˆ˜"
                  executionLogs:
                    type: array
                    description: "ì‹¤í–‰ ë¡œê·¸ (ë””ë²„ê¹…ìš©)"
                    items:
                      type: string
                    example:
                      - "ğŸš€ ì›Œí¬í”Œë¡œìš° ë¯¸ë¦¬ë³´ê¸° ì‹œì‘"
                      - "âœ… ë³€ìˆ˜ ë°ì´í„° ìºì‹œë¨: #{total_reviews} (50ê°œ í–‰)"
                      - "ğŸ”— ë§¤ì¹­ ì„±ê³µ: #{total_reviews} = \"127\" (id=1)"
        '400':
          description: ì˜ëª»ëœ ìš”ì²­
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    examples:
                      - "targetGroupsì™€ templatesê°€ í•„ìš”í•©ë‹ˆë‹¤."
                      - "SELECT ë¬¸ë§Œ í—ˆìš©ë©ë‹ˆë‹¤."
                      - "í—ˆìš©ë˜ì§€ ì•ŠëŠ” SQL í‚¤ì›Œë“œê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤."
        '500':
          description: ì„œë²„ ì˜¤ë¥˜ (SQL ì‹¤í–‰ ì‹¤íŒ¨ ë“±)
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "ë¯¸ë¦¬ë³´ê¸° ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."
                  executionLogs:
                    type: array
                    items:
                      type: string
                    example:
                      - "âŒ MySQL API í˜¸ì¶œ ì‹¤íŒ¨: 500"
                      - "âŒ ë³€ìˆ˜ ì¿¼ë¦¬ ì‹¤í–‰ ì˜¤ë¥˜: í…Œì´ë¸”ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."

  /api/workflow/test:
    post:
      tags: [Workflows]
      summary: ì›Œí¬í”Œë¡œìš° í…ŒìŠ¤íŠ¸ ì‹¤í–‰
      description: |
        **ì €ì¥ëœ ë˜ëŠ” ì„ì‹œ ì›Œí¬í”Œë¡œìš° ì„¤ì •**ìœ¼ë¡œ ì‹¤ì œ ë©”ì‹œì§€ ë°œì†¡ ë˜ëŠ” ì‹œë®¬ë ˆì´ì…˜ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
        
        ### í•µì‹¬ ê¸°ëŠ¥
        - **ì‹¤ì œ ë°œì†¡ ëª¨ë“œ**: enableRealSending=true ì‹œ ì‹¤ì œ ì•Œë¦¼í†¡/SMS ë°œì†¡
        - **í…ŒìŠ¤íŠ¸ ëª¨ë“œ**: enableRealSending=false ì‹œ ë°œì†¡ ì‹œë®¬ë ˆì´ì…˜
        - **ìë™í™” ì›Œí¬í”Œë¡œìš° ì§€ì›**: automation íƒ€ì… ì›Œí¬í”Œë¡œìš°ëŠ” í…ŒìŠ¤íŠ¸ ë²ˆí˜¸ ì‚¬ìš©
        - **ì‹¤ì œ íƒ€ê²Ÿ ê·¸ë£¹**: manual ì›Œí¬í”Œë¡œìš°ì—ì„œ ì‹¤ì œ DB ì¿¼ë¦¬ ì‹¤í–‰
        - **ì „í™”ë²ˆí˜¸ ì •ë¦¬**: í•˜ì´í”ˆ ìë™ ì œê±°ë¡œ CoolSMS API í˜¸í™˜
        
        ### ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤
        1. **ê°œë°œ/í…ŒìŠ¤íŠ¸**: ì›Œí¬í”Œë¡œìš° ë™ì‘ í™•ì¸ (enableRealSending=false)
        2. **ì‹¤ì œ ë°œì†¡**: ê´€ë¦¬ìê°€ í…ŒìŠ¤íŠ¸ ë°œì†¡ (enableRealSending=true)
        3. **ìŠ¤ì¼€ì¤„ëŸ¬ í˜¸ì¶œ**: ë‚´ë¶€ ì‹œìŠ¤í…œì—ì„œ ìë™ ì‹¤í–‰
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - workflow
              properties:
                workflow:
                  type: object
                  description: "ì‹¤í–‰í•  ì›Œí¬í”Œë¡œìš° ì„¤ì •"
                  required:
                    - name
                    - steps
                  properties:
                    id:
                      type: string
                      description: "ì›Œí¬í”Œë¡œìš° ID (ì„ íƒì )"
                      example: "550e8400-e29b-41d4-a716-446655440000"
                    name:
                      type: string
                      description: "ì›Œí¬í”Œë¡œìš° ì´ë¦„"
                      example: "ë¦¬ë·° ìš”ì²­ ì•Œë¦¼í†¡"
                    description:
                      type: string
                      description: "ì›Œí¬í”Œë¡œìš° ì„¤ëª…"
                      example: "ê³ ê°ì—ê²Œ ë¦¬ë·° ì‘ì„±ì„ ìš”ì²­í•˜ëŠ” ì›Œí¬í”Œë¡œìš°"
                    trigger_type:
                      type: string
                      enum: [manual, webhook]
                      description: "íŠ¸ë¦¬ê±° íƒ€ì…"
                      example: "manual"
                    status:
                      type: string
                      enum: [draft, active, paused, archived]
                      description: "ì›Œí¬í”Œë¡œìš° ìƒíƒœ"
                      example: "active"
                    steps:
                      type: array
                      description: "ì‹¤í–‰í•  ìŠ¤í…ë“¤"
                      minItems: 1
                      items:
                        type: object
                        properties:
                          id:
                            type: string
                            example: "step_1"
                          name:
                            type: string
                            example: "1. ë¦¬ë·° ìš”ì²­ ì•Œë¦¼í†¡ ë°œì†¡"
                          action:
                            type: object
                            properties:
                              type:
                                type: string
                                enum: [send_alimtalk, send_sms, wait]
                                example: "send_alimtalk"
                              templateId:
                                type: string
                                example: "KA01TP240213011807409jDYLqJs7GHV"
                              templateCode:
                                type: string
                                example: "MEMBERS_1_LqJs7GHV"
                              templateName:
                                type: string
                                example: "1. [ìŠˆí¼ë©¤ë²„ìŠ¤] íšŒì›ê°€ì…(ì´ìš©ì•ˆë‚´ì„œ ìˆ˜ì •ë³¸)"
                              variables:
                                type: object
                                description: "í…œí”Œë¦¿ ë³€ìˆ˜ ì„¤ì •"
                                additionalProperties:
                                  type: string
                                example:
                                  "ê°€ë§¹ì ëª…": "í…ŒìŠ¤íŠ¸ ì—…ì²´"
                              delay:
                                type: integer
                                description: "ëŒ€ê¸° ì‹œê°„ (ë¶„, wait íƒ€ì…ì¼ ë•Œ)"
                                example: 60
                    targetGroups:
                      type: array
                      description: "ëŒ€ìƒ ê·¸ë£¹ ì„¤ì • (manual ì›Œí¬í”Œë¡œìš°ì—ì„œ ì‚¬ìš©)"
                      items:
                        type: object
                        properties:
                          id:
                            type: string
                            example: "group_1"
                          name:
                            type: string
                            example: "VIP ê³ ê°"
                          type:
                            type: string
                            enum: [dynamic, static, automation]
                            example: "dynamic"
                          dynamicQuery:
                            type: object
                            properties:
                              sql:
                                type: string
                                example: "SELECT id, name, phone FROM customers WHERE grade='VIP'"
                          automationQuery:
                            type: object
                            properties:
                              event:
                                type: string
                                enum: [lead_created, signup]
                                example: "signup"
                    testSettings:
                      type: object
                      description: "í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì„¤ì •"
                      properties:
                        enableRealSending:
                          type: boolean
                          description: "ì‹¤ì œ ë©”ì‹œì§€ ë°œì†¡ ì—¬ë¶€"
                          example: false
                        testMode:
                          type: boolean
                          description: "í…ŒìŠ¤íŠ¸ ëª¨ë“œ ì—¬ë¶€"
                          example: true
                        fallbackToSMS:
                          type: boolean
                          description: "ì•Œë¦¼í†¡ ì‹¤íŒ¨ ì‹œ SMS ëŒ€ì²´ ë°œì†¡"
                          example: true
                        testPhoneNumber:
                          type: string
                          description: "í…ŒìŠ¤íŠ¸ ì „í™”ë²ˆí˜¸"
                          example: "010-1234-5678"
                    scheduleSettings:
                      $ref: '#/components/schemas/ScheduleConfig'
      responses:
        '200':
          description: í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "ì›Œí¬í”Œë¡œìš° í…ŒìŠ¤íŠ¸ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."
                  results:
                    type: array
                    description: "ê° ìŠ¤í… ì‹¤í–‰ ê²°ê³¼"
                    items:
                      type: object
                      properties:
                        step:
                          type: integer
                          description: "ìŠ¤í… ë²ˆí˜¸"
                          example: 1
                        type:
                          type: string
                          enum: [alimtalk, sms, wait]
                          example: "alimtalk"
                        status:
                          type: string
                          enum: [success, failed]
                          example: "success"
                        message:
                          type: string
                          example: "ì•Œë¦¼í†¡ ë°œì†¡ ì™„ë£Œ"
                        messageId:
                          type: string
                          description: "ë°œì†¡ ë©”ì‹œì§€ ID"
                          example: "G4V20250731134801XMJJ90TEHSCG7JN"
                        processedContent:
                          type: string
                          description: "ë³€ìˆ˜ ì¹˜í™˜ëœ ìµœì¢… ë©”ì‹œì§€"
                          example: "ì•ˆë…•í•˜ì„¸ìš” í…ŒìŠ¤íŠ¸ ì—…ì²´ ë‹´ë‹¹ìë‹˜..."
                        fallbackToSMS:
                          type: boolean
                          description: "SMS ëŒ€ì²´ ë°œì†¡ ì—¬ë¶€"
                          example: false
                        variables:
                          type: object
                          description: "ì‚¬ìš©ëœ ë³€ìˆ˜ë“¤"
                          additionalProperties:
                            type: string
                          example:
                            "ê°€ë§¹ì ëª…": "í…ŒìŠ¤íŠ¸ ì—…ì²´"
                        recipient:
                          type: object
                          description: "ìˆ˜ì‹ ì ì •ë³´"
                          properties:
                            name:
                              type: string
                              example: "í…ŒìŠ¤íŠ¸ ê³ ê°"
                            phone:
                              type: string
                              example: "01012345678"
                            company:
                              type: string
                              example: "í…ŒìŠ¤íŠ¸ íšŒì‚¬"
                        error:
                          type: string
                          description: "ì‹¤íŒ¨ ì‹œ ì˜¤ë¥˜ ë©”ì‹œì§€"
                          example: "í…œí”Œë¦¿ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
                  executionTime:
                    type: string
                    format: date-time
                    description: "ì‹¤í–‰ ì™„ë£Œ ì‹œê°„"
                    example: "2025-07-31T04:48:01.727Z"
                  testSettings:
                    type: object
                    description: "ì‚¬ìš©ëœ í…ŒìŠ¤íŠ¸ ì„¤ì •"
                    properties:
                      enableRealSending:
                        type: boolean
                        example: false
                      fallbackToSMS:
                        type: boolean
                        example: true
                      phoneNumber:
                        type: string
                        example: "010-6313-6764"
                  envStatus:
                    type: object
                    description: "í™˜ê²½ë³€ìˆ˜ ì„¤ì • ìƒíƒœ"
                    properties:
                      COOLSMS_API_KEY:
                        type: boolean
                        example: true
                      COOLSMS_API_SECRET:
                        type: boolean
                        example: true
                      KAKAO_SENDER_KEY:
                        type: boolean
                        example: true
                      TEST_PHONE_NUMBER:
                        type: boolean
                        example: false
                      phoneNumber:
                        type: string
                        example: "010-6313-6764"
                      useRealTargets:
                        type: boolean
                        example: false
                  realSendingStatus:
                    type: string
                    description: "ì‹¤ì œ ë°œì†¡ ìƒíƒœ ì„¤ëª…"
                    examples:
                      - "í…ŒìŠ¤íŠ¸ ëª¨ë“œë¡œ ì‹¤í–‰ë¨"
                      - "ì‹¤ì œ ë°œì†¡ ì‹œë„ë¨"
                      - "í™˜ê²½ë³€ìˆ˜ ëˆ„ë½ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ëª¨ë“œë¡œ ì‹¤í–‰ë¨"
        '400':
          description: ì˜ëª»ëœ ìš”ì²­
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    examples:
                      - "workflow ê°ì²´ê°€ í•„ìš”í•©ë‹ˆë‹¤."
                      - "stepsê°€ í•„ìš”í•©ë‹ˆë‹¤."
                      - "ì‹¤ì œ íƒ€ê²Ÿ ê·¸ë£¹ì—ì„œ ì¡°íšŒëœ ì—°ë½ì²˜ê°€ ì—†ìŠµë‹ˆë‹¤."
                  error:
                    type: string
                    example: "ìƒì„¸ ì˜¤ë¥˜ ì •ë³´"
        '500':
          description: ì„œë²„ ì˜¤ë¥˜
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "ì›Œí¬í”Œë¡œìš° í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."
                  error:
                    type: object
                    description: "ìƒì„¸ ì˜¤ë¥˜ ì •ë³´"

  # Messaging
  /api/sms/send:
    post:
      tags: [Messaging]
      summary: SMS ë°œì†¡
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SMSRequest'
      responses:
        '200':
          description: SMS ë°œì†¡ ì„±ê³µ
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      messageId:
                        type: string
                        example: "test_sms_1753779972569"
                      messageType:
                        type: string
                        enum: [SMS, LMS]
                        example: "SMS"
                      processedMessage:
                        type: string
                        example: "ì²˜ë¦¬ëœ ë©”ì‹œì§€"
                      testMode:
                        type: boolean
                        example: true
                      actualSending:
                        type: boolean
                        example: false
                      variables:
                        type: object
        '400':
          description: ì˜ëª»ëœ ìš”ì²­
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/send-message:
    post:
      tags: [Messaging]
      summary: í†µí•© ë©”ì‹œì§€ ë°œì†¡
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: ë©”ì‹œì§€ ë°œì†¡ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  # Database
  /api/mysql/query:
    get:
      tags: [Database]
      summary: MySQL ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸
      parameters:
        - name: test
          in: query
          schema:
            type: string
            enum: [connection]
          example: "connection"
      responses:
        '200':
          description: í…ŒìŠ¤íŠ¸ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
    
    post:
      tags: [Database]
      summary: MySQL ì¿¼ë¦¬ ì‹¤í–‰
      description: |
        SQL ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
        
        **ì œí•œì‚¬í•­:**
        - SELECT ë¬¸ë§Œ í—ˆìš©
        - ìœ„í—˜í•œ í‚¤ì›Œë“œ ì°¨ë‹¨: drop, delete, update, insert, alter, create, truncate
        - ìµœëŒ€ 50,000 í–‰ ì œí•œ
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QueryRequest'
      responses:
        '200':
          description: ì¿¼ë¦¬ ì‹¤í–‰ ì„±ê³µ
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          rows:
                            type: array
                            items:
                              type: object
                          rowCount:
                            type: integer
                            example: 0
        '400':
          description: ì˜ëª»ëœ ì¿¼ë¦¬
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/mysql/schema:
    get:
      tags: [Database]
      summary: ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì¡°íšŒ
      responses:
        '200':
          description: ìŠ¤í‚¤ë§ˆ ì¡°íšŒ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /api/mysql/statistics:
    get:
      tags: [Database]
      summary: ë°ì´í„°ë² ì´ìŠ¤ í†µê³„
      responses:
        '200':
          description: í†µê³„ ì¡°íšŒ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /api/mysql/companies:
    get:
      tags: [Database]
      summary: íšŒì‚¬ ë°ì´í„° ì¡°íšŒ
      responses:
        '200':
          description: íšŒì‚¬ ë°ì´í„° ì¡°íšŒ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /api/mysql/variables:
    get:
      tags: [Database]
      summary: ë³€ìˆ˜ ë§¤í•‘ ì¡°íšŒ
      parameters:
        - name: action
          in: query
          required: true
          schema:
            type: string
            enum: [tables, variables]
        - name: table
          in: query
          schema:
            type: string
          description: "í…Œì´ë¸”ëª… (action=variablesì¼ ë•Œ í•„ìš”)"
      responses:
        '200':
          description: ë³€ìˆ˜ ë§¤í•‘ ì¡°íšŒ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /api/mysql/table-mappings:
    get:
      tags: [Database]
      summary: í…Œì´ë¸” ë§¤í•‘ ì¡°íšŒ
      responses:
        '200':
          description: í…Œì´ë¸” ë§¤í•‘ ì¡°íšŒ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
    
    post:
      tags: [Database]
      summary: í…Œì´ë¸” ë§¤í•‘ ê´€ë¦¬
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - action
                - tableName
              properties:
                action:
                  type: string
                  enum: [save, delete, toggle]
                tableName:
                  type: string
                  example: "í…Œì´ë¸”ëª…"
                mapping:
                  type: object
      responses:
        '200':
          description: í…Œì´ë¸” ë§¤í•‘ ê´€ë¦¬ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /api/mysql/targets/preview:
    post:
      tags: [Database]
      summary: ëŒ€ìƒ ë¯¸ë¦¬ë³´ê¸°
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: ëŒ€ìƒ ë¯¸ë¦¬ë³´ê¸° ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  # Scheduler
  /api/scheduler:
    get:
      tags: [Scheduler]
      summary: ìŠ¤ì¼€ì¤„ëŸ¬ ìƒíƒœ ì¡°íšŒ
      responses:
        '200':
          description: ìŠ¤ì¼€ì¤„ëŸ¬ ìƒíƒœ ì¡°íšŒ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
    
    post:
      tags: [Scheduler]
      summary: ìŠ¤ì¼€ì¤„ëŸ¬ ìƒíƒœ ê´€ë¦¬
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - action
              properties:
                action:
                  type: string
                  example: "cancel_workflow_schedule"
                workflowId:
                  type: string
                  example: "workflow_123"
      responses:
        '200':
          description: ìŠ¤ì¼€ì¤„ëŸ¬ ìƒíƒœ ê´€ë¦¬ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /api/scheduler/health:
    get:
      tags: [Scheduler]
      summary: ìŠ¤ì¼€ì¤„ëŸ¬ í—¬ìŠ¤ì²´í¬
      responses:
        '200':
          description: í—¬ìŠ¤ì²´í¬ ì„±ê³µ
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          health_check:
                            type: object
                            properties:
                              timestamp:
                                type: string
                                format: date-time
                              korea_time:
                                type: string
                              check_type:
                                type: string
                              environment:
                                type: string
                              aws_lambda_enabled:
                                type: boolean
                          cron_status:
                            type: object
                            properties:
                              has_signals:
                                type: boolean
                              last_aws_signal:
                                type: object
                              minutes_since_last_signal:
                                type: integer
                              is_healthy:
                                type: boolean
                              health_status:
                                type: string
                          lambda_status:
                            type: object
                            properties:
                              is_working:
                                type: boolean
                              last_execution:
                                type: string
                                nullable: true
                              pending_overdue_count:
                                type: integer
                              recent_execution_count:
                                type: integer
                          statistics:
                            type: object
                            properties:
                              total:
                                type: integer
                              pending:
                                type: integer
                              running:
                                type: integer
                              completed:
                                type: integer
                              failed:
                                type: integer

  # Webhooks
  /api/webhook/{eventType}:
    post:
      tags: [Webhooks]
      summary: ë™ì  ì›¹í›… ì²˜ë¦¬
      description: |
        ì›¹í›… ì´ë²¤íŠ¸ë¥¼ ë°›ì•„ì„œ í•´ë‹¹í•˜ëŠ” ì›Œí¬í”Œë¡œìš°ë¥¼ ì¦‰ì‹œì‹¤í–‰í•˜ê±°ë‚˜ ì§€ì—°ì‹¤í–‰í•©ë‹ˆë‹¤.
        - ì¦‰ì‹œì‹¤í–‰: schedule_config.typeì´ 'immediate'ì¸ ê²½ìš° ë°”ë¡œ ì‹¤í–‰
        - ì§€ì—°ì‹¤í–‰: schedule_config.typeì´ 'delay'ì¸ ê²½ìš° scheduled_jobsì— ì¶”ê°€
        
        **ì§€ì›í•˜ëŠ” ì´ë²¤íŠ¸ íƒ€ì…:** `lead_created`, `signup`, `purchase`, `cancel`, `payment_failed`
      parameters:
        - name: eventType
          in: path
          required: true
          schema:
            type: string
            enum: [lead_created, signup, purchase, cancel, payment_failed]
          example: "lead_created"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WebhookEvent'
      responses:
        '200':
          description: ì´ë²¤íŠ¸ ì²˜ë¦¬ ì„±ê³µ
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      triggered_workflows:
                        type: array
                        items:
                          type: object
                          properties:
                            workflowId:
                              type: string
                            workflowName:
                              type: string
                            executionType:
                              type: string
                              enum: [immediate, delayed]
                              description: "ì‹¤í–‰ ë°©ì‹"
                            executionResult:
                              type: object
                              description: "ì¦‰ì‹œì‹¤í–‰ ê²°ê³¼ (executionTypeì´ immediateì¸ ê²½ìš°)"
                            scheduledJobId:
                              type: string
                              description: "ì§€ì—°ì‹¤í–‰ ì‘ì—… ID (executionTypeì´ delayedì¸ ê²½ìš°)"
                            conditions:
                              type: array
                            conditionsPassed:
                              type: boolean
                            error:
                              type: string
                              description: "ì‹¤í–‰ ì‹¤íŒ¨ ì‹œ ì˜¤ë¥˜ ë©”ì‹œì§€"
                      event_data:
                        type: object

  # Templates
  /api/templates/coolsms/list:
    get:
      tags: [Templates]
      summary: CoolSMS í…œí”Œë¦¿ ëª©ë¡
      responses:
        '200':
          description: í…œí”Œë¦¿ ëª©ë¡ ì¡°íšŒ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /api/templates/coolsms/sdk-list:
    get:
      tags: [Templates]
      summary: CoolSMS SDK ëª©ë¡
      responses:
        '200':
          description: SDK ëª©ë¡ ì¡°íšŒ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /api/templates/coolsms/real:
    get:
      tags: [Templates]
      summary: CoolSMS ì‹¤ì œ í…œí”Œë¦¿
      responses:
        '200':
          description: ì‹¤ì œ í…œí”Œë¦¿ ì¡°íšŒ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /api/templates/coolsms/test:
    get:
      tags: [Templates]
      summary: CoolSMS í…ŒìŠ¤íŠ¸
      responses:
        '200':
          description: í…ŒìŠ¤íŠ¸ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /api/templates/coolsms/sync:
    get:
      tags: [Templates]
      summary: CoolSMS ë™ê¸°í™”
      responses:
        '200':
          description: ë™ê¸°í™” ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /api/templates/coolsms/{templateId}:
    get:
      tags: [Templates]
      summary: íŠ¹ì • í…œí”Œë¦¿ ì¡°íšŒ
      parameters:
        - name: templateId
          in: path
          required: true
          schema:
            type: string
          example: "template_123"
      responses:
        '200':
          description: í…œí”Œë¦¿ ì¡°íšŒ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /api/templates/{templateId}/details:
    get:
      tags: [Templates]
      summary: í…œí”Œë¦¿ ìƒì„¸ ì •ë³´
      parameters:
        - name: templateId
          in: path
          required: true
          schema:
            type: string
          example: "template_123"
      responses:
        '200':
          description: í…œí”Œë¦¿ ìƒì„¸ ì •ë³´ ì¡°íšŒ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /api/templates/sync:
    get:
      tags: [Templates]
      summary: í…œí”Œë¦¿ ë™ê¸°í™” ì¡°íšŒ
      responses:
        '200':
          description: ë™ê¸°í™” ìƒíƒœ ì¡°íšŒ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
    
    post:
      tags: [Templates]
      summary: í…œí”Œë¦¿ ë™ê¸°í™” ì‹¤í–‰
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: ë™ê¸°í™” ì‹¤í–‰ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /api/templates/usage:
    get:
      tags: [Templates]
      summary: í…œí”Œë¦¿ ì‚¬ìš©ëŸ‰
      responses:
        '200':
          description: ì‚¬ìš©ëŸ‰ ì¡°íšŒ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  # Auth
  /api/auth/signup:
    post:
      tags: [Auth]
      summary: íšŒì›ê°€ì…
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: "user@example.com"
                password:
                  type: string
                  format: password
                  example: "password123"
                name:
                  type: string
                  example: "í™ê¸¸ë™"
      responses:
        '200':
          description: íšŒì›ê°€ì… ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: ì˜ëª»ëœ ìš”ì²­
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # System
  /api/test-env:
    get:
      tags: [System]
      summary: í™˜ê²½ ë³€ìˆ˜ í™•ì¸
      responses:
        '200':
          description: í™˜ê²½ ë³€ìˆ˜ í™•ì¸ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /api/db-fields:
    get:
      tags: [System]
      summary: ë°ì´í„°ë² ì´ìŠ¤ í•„ë“œ ì¡°íšŒ
      responses:
        '200':
          description: í•„ë“œ ì¡°íšŒ ì„±ê³µ
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          type: object
                          properties:
                            name:
                              type: string
                              example: "user_name"
                            label:
                              type: string
                              example: "ê³ ê°ëª…"
                            type:
                              type: string
                              example: "string"
                            table:
                              type: string
                              example: "users"

  /api/system/cleanup:
    get:
      tags: [System]
      summary: ì‹œìŠ¤í…œ ì •ë¦¬ ìƒíƒœ ì¡°íšŒ
      responses:
        '200':
          description: ì •ë¦¬ ìƒíƒœ ì¡°íšŒ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
    
    post:
      tags: [System]
      summary: ì‹œìŠ¤í…œ ì •ë¦¬ ì‹¤í–‰
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: ì •ë¦¬ ì‹¤í–‰ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  # Additional endpoints can be added here following the same pattern... 