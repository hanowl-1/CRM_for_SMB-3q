# 워크플로우 빌더 기능 PRD
## 메시지 자동화 플랫폼 - 워크플로우 빌더

### 1. 기능 개요

#### 1.1 기능명
**워크플로우 빌더 (Workflow Builder)**

#### 1.2 기능 목적
사용자가 직관적이고 단계별로 메시지 자동화 워크플로우를 생성할 수 있는 가이드형 빌더 제공

#### 1.3 핵심 가치
- **단계별 가이드**: 복잡한 설정을 6단계로 나누어 사용자 친화적 경험 제공
- **실시간 검증**: 각 단계에서 설정의 완성도를 실시간으로 체크
- **유연한 매핑**: 동적 대상과 템플릿 간 자동 변수 매핑
- **즉시 테스트**: 설정 완료 후 바로 테스트 실행 가능

### 2. ✅ 구현 완료된 기능

#### 2.1 ✅ 6단계 워크플로우 빌더

##### 2.1.1 ✅ 1단계: 기본정보
- **✅ 구현된 기능:**
  - 워크플로우 이름 입력 (필수)
  - 워크플로우 설명 입력 (필수)
  - 실시간 입력 검증
  - 다음 단계 진행 조건 체크

- **✅ UI/UX 특징:**
  - 직관적인 폼 레이아웃
  - 필수 필드 표시
  - 완성도 체크 아이콘

##### 2.1.2 ✅ 2단계: 알림톡 템플릿 선택
- **✅ 구현된 기능:**
  - 템플릿 브라우저 통합
  - 다중 템플릿 선택 지원
  - 템플릿별 변수 매핑 UI
  - 실시간 메시지 미리보기
  - 개인화 설정 통합

- **✅ 고급 기능:**
  - 템플릿 변수 자동 인식
  - 변수별 소스 타입 선택 (정적값, 동적쿼리, 함수)
  - 쿼리 결과 미리보기
  - 변수 매핑 저장/불러오기

##### 2.1.3 ✅ 3단계: 대상 선정
- **✅ 구현된 기능:**
  - 정적 대상 그룹 (직접 전화번호 입력)
  - 동적 대상 그룹 (MySQL 쿼리 기반)
  - 쿼리 실시간 테스트 및 검증
  - 대상 수 미리보기
  - 다중 대상 그룹 지원

- **✅ MySQL 연동:**
  - 실시간 쿼리 실행
  - 쿼리 결과 검증
  - 에러 처리 및 디버깅
  - 쿼리 템플릿 저장

##### 2.1.4 ✅ 4단계: 대상-템플릿 매핑
- **✅ 구현된 기능:**
  - 동적 대상과 템플릿 간 자동 매핑
  - 쿼리 결과 컬럼과 템플릿 변수 매칭
  - 매핑 완성도 실시간 체크
  - 변수별 기본값 설정

- **✅ 스마트 매핑:**
  - 컬럼명 기반 자동 추천
  - 데이터 타입 검증
  - 누락된 매핑 경고
  - 매핑 템플릿 저장/재사용

##### 2.1.5 ✅ 5단계: 스케줄러 설정
- **✅ 구현된 기능:**
  - 즉시 발송 옵션
  - 지연 발송 설정 (분/시간/일)
  - 특정 시간대 제한
  - 반복 발송 설정

- **✅ 고급 스케줄링:**
  - 타임존 설정 (Asia/Seoul)
  - 발송 제한 시간 설정
  - 주말/공휴일 제외 옵션

##### 2.1.6 ✅ 6단계: 테스트 설정
- **✅ 구현된 기능:**
  - 테스트 수신 번호 설정
  - 실제 발송 vs 시뮬레이션 모드
  - SMS 대체 발송 옵션
  - 테스트 메모 작성

- **✅ 실시간 테스트:**
  - 즉시 테스트 실행
  - 단계별 실행 결과 표시
  - 성공/실패 로그 제공
  - 에러 디버깅 정보

#### 2.2 ✅ 워크플로우 관리 기능

##### 2.2.1 ✅ 저장 및 불러오기
- **✅ Supabase 연동:**
  - 영구 저장 시스템
  - 실시간 동기화
  - 데이터 백업 (localStorage)
  - 버전 관리

- **✅ 워크플로우 상태 관리:**
  - 초안(draft) 상태
  - 활성(active) 상태
  - 일시정지(paused) 상태
  - 보관(archived) 상태

##### 2.2.2 ✅ 편집 및 복제
- **✅ 구현된 기능:**
  - 기존 워크플로우 편집
  - 워크플로우 복제
  - 설정 이력 추적
  - 변경사항 감지

#### 2.3 ✅ 사용자 경험 최적화

##### 2.3.1 ✅ 진행 상태 표시
- **✅ 구현된 기능:**
  - 탭별 완성도 체크
  - 진행률 표시
  - 필수 설정 알림
  - 다음/이전 단계 네비게이션

##### 2.3.2 ✅ 실시간 검증
- **✅ 구현된 기능:**
  - 입력값 실시간 검증
  - 쿼리 구문 검사
  - 매핑 완성도 체크
  - 에러 메시지 표시

### 3. 기술 구현 상세

#### 3.1 ✅ Frontend 구조
```typescript
// 주요 컴포넌트 구조
WorkflowBuilder
├── BasicInfoTab          // 1단계: 기본정보
├── TemplateSelectionTab  // 2단계: 템플릿 선택
├── TargetSelectionTab    // 3단계: 대상 선정
├── MappingTab           // 4단계: 대상-템플릿 매핑
├── ScheduleTab          // 5단계: 스케줄러
└── TestTab              // 6단계: 테스트 설정
```

#### 3.2 ✅ 상태 관리
- **✅ React Hooks 기반:**
  - useState로 각 단계별 상태 관리
  - useCallback으로 성능 최적화
  - useEffect로 데이터 동기화

#### 3.3 ✅ 데이터 구조
```typescript
interface Workflow {
  id: string;
  name: string;
  description: string;
  status: 'draft' | 'active' | 'paused' | 'archived';
  trigger: WorkflowTrigger;
  targetGroups: TargetGroup[];
  steps: WorkflowStep[];
  testSettings: WorkflowTestSettings;
  scheduleSettings: ScheduleSettings;
  createdAt: string;
  updatedAt: string;
}
```

### 4. 사용자 워크플로우

#### 4.1 ✅ 신규 워크플로우 생성
1. **✅ 진입점:** 대시보드 → "새 워크플로우 만들기" 버튼
2. **✅ 1단계:** 기본정보 입력 (이름, 설명)
3. **✅ 2단계:** 템플릿 선택 및 변수 매핑
4. **✅ 3단계:** 대상 그룹 설정 (정적/동적)
5. **✅ 4단계:** 대상-템플릿 매핑 완성
6. **✅ 5단계:** 스케줄러 설정
7. **✅ 6단계:** 테스트 실행 및 저장

#### 4.2 ✅ 기존 워크플로우 편집
1. **✅ 진입점:** 대시보드 워크플로우 목록 → 편집 버튼
2. **✅ 데이터 로드:** 기존 설정 자동 복원
3. **✅ 단계별 수정:** 필요한 단계만 수정 가능
4. **✅ 변경사항 저장:** 실시간 저장 및 동기화

### 5. 성능 최적화

#### 5.1 ✅ 구현된 최적화
- **✅ 컴포넌트 메모이제이션:** React.memo, useCallback 사용
- **✅ 지연 로딩:** 대용량 템플릿 목록 페이지네이션
- **✅ 실시간 검증:** 디바운싱으로 API 호출 최적화
- **✅ 캐싱:** 쿼리 결과 및 템플릿 데이터 캐싱

#### 5.2 🔄 향후 최적화 계획
- 🔄 가상화 스크롤링 (대용량 데이터)
- 🔄 백그라운드 저장 (Auto-save)
- 🔄 오프라인 지원
- 🔄 실시간 협업 기능

### 6. 에러 처리

#### 6.1 ✅ 구현된 에러 처리
- **✅ 입력 검증:** 실시간 폼 검증
- **✅ 네트워크 에러:** 재시도 로직 및 사용자 알림
- **✅ 데이터 무결성:** 단계별 필수 조건 체크
- **✅ 쿼리 에러:** SQL 구문 오류 감지 및 안내

#### 6.2 ✅ 사용자 가이드
- **✅ 도움말 툴팁:** 각 설정 항목별 설명
- **✅ 예제 제공:** 쿼리 템플릿 및 샘플 데이터
- **✅ 에러 메시지:** 구체적이고 해결 방법 포함
- **✅ 진행 가이드:** 단계별 완성 조건 안내

### 7. 보안 및 권한

#### 7.1 ✅ 구현된 보안 기능
- **✅ 데이터 검증:** 서버 사이드 입력 검증
- **✅ SQL 인젝션 방지:** 매개변수화 쿼리 사용
- **✅ 권한 분리:** 읽기 전용 MySQL 연결
- **✅ 데이터 암호화:** Supabase 내장 암호화

### 8. 테스트 및 품질 보증

#### 8.1 ✅ 구현된 테스트
- **✅ 단위 테스트:** 핵심 로직 검증
- **✅ 통합 테스트:** API 연동 테스트
- **✅ 사용자 테스트:** 실제 워크플로우 시나리오
- **✅ 성능 테스트:** 대용량 데이터 처리

### 9. 모니터링 및 분석

#### 9.1 ✅ 구현된 모니터링
- **✅ 사용 통계:** 단계별 완성률 추적
- **✅ 에러 로깅:** 실시간 에러 수집
- **✅ 성능 모니터링:** 응답 시간 측정
- **✅ 사용자 행동:** 단계별 이탈률 분석

### 10. 향후 개발 계획

#### 10.1 🔄 단기 개선 사항 (1-2개월)
- 🔄 **성능 최적화:** 대용량 데이터 처리 개선
- 🔄 **사용자 경험:** 드래그&드롭 인터페이스
- 🔄 **고급 스케줄링:** 복잡한 시간 조건 설정
- 🔄 **템플릿 추천:** AI 기반 템플릿 추천

#### 10.2 ❌ 장기 개발 계획 (3-6개월)
- ❌ **시각적 빌더:** 플로우차트 형태의 빌더
- ❌ **A/B 테스트:** 다중 템플릿 성과 비교
- ❌ **실시간 협업:** 다중 사용자 편집
- ❌ **워크플로우 템플릿:** 업종별 사전 정의 템플릿

### 11. 성공 지표

#### 11.1 ✅ 측정 가능한 지표
- **✅ 완성률:** 6단계 모두 완료한 워크플로우 비율
- **✅ 소요 시간:** 평균 워크플로우 생성 시간
- **✅ 재사용률:** 기존 워크플로우 편집/복제 빈도
- **✅ 테스트 성공률:** 테스트 단계 성공 비율

#### 11.2 🔄 목표 지표 (향후 설정)
- 🔄 **사용자 만족도:** NPS 점수 8.0 이상
- 🔄 **완성률:** 90% 이상
- 🔄 **평균 생성 시간:** 10분 이내
- 🔄 **에러율:** 5% 이하

### 12. 결론

워크플로우 빌더는 **메시지 자동화 플랫폼의 핵심 기능**으로서 완전히 구현되었습니다. 

#### ✅ 주요 성과:
- **직관적인 6단계 가이드** 시스템
- **실시간 검증 및 미리보기** 기능
- **MySQL + Supabase 완전 연동**
- **사용자 친화적 UI/UX** 완성

현재 상태에서 **실제 운영 환경에서 충분히 사용 가능**하며, 향후 성능 최적화와 고급 기능 추가를 통해 더욱 발전시켜 나갈 예정입니다. 